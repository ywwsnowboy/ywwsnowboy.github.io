<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>ROS编程实现 | 既然选择了远方 便只顾风雨兼程</title><meta name="keywords" content="ROS"><meta name="author" content="snowboy"><meta name="copyright" content="snowboy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文主要内容是ROS编程实现。">
<meta property="og:type" content="article">
<meta property="og:title" content="ROS编程实现">
<meta property="og:url" content="https://ywwsnowboy.github.io/2022/05/06/ROS/ROS%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0/index.html">
<meta property="og:site_name" content="既然选择了远方 便只顾风雨兼程">
<meta property="og:description" content="本文主要内容是ROS编程实现。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/03/12/LHTi19ID7PoAWfG.jpg">
<meta property="article:published_time" content="2022-05-06T14:53:28.000Z">
<meta property="article:modified_time" content="2023-03-15T12:14:21.618Z">
<meta property="article:author" content="snowboy">
<meta property="article:tag" content="ROS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/03/12/LHTi19ID7PoAWfG.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://ywwsnowboy.github.io/2022/05/06/ROS/ROS%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":888},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: snowboy","link":"链接: ","source":"来源: 既然选择了远方 便只顾风雨兼程","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ROS编程实现',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-15 20:14:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">40</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 资源</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2023/03/12/LHTi19ID7PoAWfG.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">既然选择了远方 便只顾风雨兼程</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 资源</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ROS编程实现</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-06T14:53:28.000Z" title="发表于 2022-05-06 22:53:28">2022-05-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-15T12:14:21.618Z" title="更新于 2023-03-15 20:14:21">2023-03-15</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>47分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ROS编程实现"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>ROS编程实现</h1>
<h2 id="1-创造工作空间和功能包">1. 创造工作空间和功能包</h2>
<p>工作空间（workspace）是一个存放工程开发相关文件的文件夹</p>
<p><strong>src</strong>：代码空间（Source Space），用来放置功能包的代码、配置文件、launch文件</p>
<p><strong>build</strong>：编译空间（Build Space），编译过程中产生的中间文件，二进制文件，不用考虑</p>
<p><strong>devel</strong>：开发空间（Development Space）放置开发中编译生成的可执行文件，一些库、脚本</p>
<p><strong>install</strong>：安装空间（Install Space），安装指令/程序的位置，放置开发后生成的可执行文件，和devel文件夹类似</p>
<p><img src="https://vip2.loli.io/2023/03/13/4U3YOziuL1brVHE.png" alt="image-20220107221102273"></p>
<h3 id="1-1-创建工作空间">1.1 创建工作空间</h3>
<p><strong>创建工作空间</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/catkin_ws/src</span><br><span class="line"><span class="built_in">cd</span> ~/catkin_ws/src</span><br><span class="line">catkin_init_workspace</span><br></pre></td></tr></table></figure>
<p><strong>编译工作空间</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws/</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure>
<p><strong>设置环境变量</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br></pre></td></tr></table></figure>
<p><strong>检查环境变量</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$ROS_PACKAGE_PATH</span>   <span class="comment"># 显示ROS功能包路径，只有前面source之后才能通过echo命令显示出来</span></span><br></pre></td></tr></table></figure>
<p>如果想产生install文件夹，可以通过<code>catkin_make install</code>编译后即可产生install安装空间，存放最终编译的可执行文件</p>
<p><img src="https://vip2.loli.io/2023/03/13/KsGfw1ahl3TObqp.png" alt="image-20220107223553725"></p>
<h3 id="1-2-创建功能包">1.2 创建功能包</h3>
<p><strong>创建功能包</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws/src</span><br><span class="line">catkin_create_pkg test_pkg std_msgs rospy roscpp catkin_create_pkg &lt;package_name&gt; [depend 1][depend 2][depend 3]</span><br></pre></td></tr></table></figure>
<p>test_pkg编译过程中用到哪些库，就需要跟哪些依赖，比如std_msgs、rospy、roscpp，这些库都放到src文件夹中。</p>
<p><strong>编译功能包</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make</span><br><span class="line"><span class="built_in">source</span> ~/catkin_ws/devel/setup.bash</span><br></pre></td></tr></table></figure>
<p><strong>同一个工作空间下，不允许存在同名功能包，不同工作空间下，允许存在同名功能包</strong></p>
<p>编译过后，C++头文件可以放到include文件夹中，功能包中一定有CMakeLists.txt和package.xml，这两个文件说明该文件夹为功能包。</p>
<p><strong>package.xml的作用</strong>：记录该功能包相关的信息、个人信息、开源许可证、功能包依赖信息等，如果需要增加相应的依赖，可以再进行拓展。</p>
<p><strong>CMakeLists.txt的作用</strong>：描述功能包的编译规则，主要的语法是Cmake语法。</p>
<h2 id="2-发布者Publisher的编程实现">2. 发布者Publisher的编程实现</h2>
<p>发布者编程实现原理图：</p>
<p><img src="https://vip2.loli.io/2023/03/13/dmIiyEf2h9rB3qt.png" alt="image-20220108001134600"></p>
<h3 id="2-1-创建功能包">2.1 创建功能包</h3>
<p>具体操作步骤：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~catkin_ws/src</span><br><span class="line">catkin_create_pkg learning_topic rospy roscpp std_msgs geometry_msgs turtlesim</span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/NdroFRhOAfUyJMt.png" alt="image-20220108001818372"></p>
<h3 id="2-2-配置发布者代码编译规则">2.2 配置发布者代码编译规则</h3>
<p><strong>如何配置CMakeLists.txt中的编译规则：</strong></p>
<ul>
<li>设置需要编译的代码和生成的可执行文件；</li>
<li>设置链接库；</li>
<li>CMakeLists.txt中主要描述了如何编译以及编译的规则。</li>
</ul>
<p>在<code>~/catkin_ws/src/learning_topic</code>文件夹下的<code>CMakeLists.txt</code>文件中加入如下代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_executable(velocity_publisher src/velocity_publisher.cpp) <span class="comment">##将src/velocity_publisher.cpp编译成名为velocity_publisher的可执行文件</span></span><br><span class="line">target_link_libraries(velocity_publisher <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>) <span class="comment">##将可执行文件velocity_publisher和ROS相关的库做一个链接，比如C++的接口#python不用做接口，python不需要编译</span></span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/ptEPkH6lIseZ4xu.png" alt="image-20220108232013967"></p>
<h3 id="2-3-用C-python实现发布者">2.3 用C++/python实现发布者</h3>
<p>在src文件夹中创建cpp文件</p>
<p><strong>C++代码实现一个发布者</strong>：</p>
<ul>
<li>初始化ROS节点；</li>
<li>向ROS Master注册节点信息，包括发布的话题名和话题中的消息类型；</li>
<li>创建消息数据；</li>
<li>按照一定频率循环发布消息。</li>
</ul>
<p><strong>具体实现的C++代码</strong>：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*该例程将发布turtle1/cmd_vel话题，消息类型geometry_msgs:Twist</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span>    <span class="comment">//包含ROS相关的头文件</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;geometry_msgs/Twist.h&gt;</span>  <span class="comment">//ROS中线速度和角速度相关消息的头文件，geometry_msgs库中已经定义好的头文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ROS节点初始化，</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;velocity_publisher&quot;</span>); <span class="comment">//velocity_publisher为节点的名字，在ROS中节点名不能重复。                             //argc和argv为输入的参数来设置初始化的属性，默认情况下属性不作配置，只有velocity_publisher这个名字</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建节点句柄，主要用来管理ROS相关API的资源，比如发布者创建API调用需要节点句柄的调用，用来管理节点资源。</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*创建一个Publisher，发布名为/turtle1/cmd_vel的topic，消息类型为geometry_msgs::Twist，队列长度10。Publisher里面有一个缓存（队列），先把数据放入缓存中，再根据实际传输能力传输数据，当缓存空间不够或者传输速度太慢，会将最老的数据删除，只保留缓存长度的数据，再进行数据传输，出现这种情况时，会出现掉帧掉数据的情况*/</span></span><br><span class="line">    ros==Publisher turtle_vel_pub = n.<span class="built_in">advertise</span>&lt;geometry_msgs==Twist&gt;(<span class="string">&quot;/turtle1/cmd_vel&quot;</span>,<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置循环的频率，后续有一个while循环，loop_rate用来设置频率的</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>()) <span class="comment">//封装数据，发不出去，延时满足频率，进行下一次循环</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 初始化geometry_msgs::Twist类型的消息，</span></span><br><span class="line">        geometry_msgs::Twist vel_msg; <span class="comment">//设置Twist消息的内容，首先创建Twist消息，Twist是一个类，首先创建类的对象，对象中包括线速度角速度</span></span><br><span class="line">        vel_msg.linear.x = <span class="number">0.5</span>;  <span class="comment">//设置线速度</span></span><br><span class="line">        vel_msg.angular.z = <span class="number">0.2</span>;  <span class="comment">//设置角速度</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 发布消息</span></span><br><span class="line">        turtle_vel_pub.<span class="built_in">publish</span>(vel_msg); <span class="comment">//调用发布者turtle_vel_pub，使用publish这个方法，publisher的输入是vel_msg</span></span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Publish turtlesim velocity command[%0.2f m/s, %0.2f rad/s]&quot;</span>,vel_msg.linear.x, vel_msg.angular.z);</span><br><span class="line">        <span class="comment">//ROS_INFO相当于printf，用来输出信息</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 按照循环频率演示</span></span><br><span class="line">        loop_rate.<span class="built_in">sleep</span>();<span class="comment">//延时10Hz</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>python代码实现一个发布者</strong>：</p>
<ul>
<li>初始化ROS节点；</li>
<li>向ROS Master注册节点信息，包括发布的话题名和话题中的消息类型；</li>
<li>创建消息数据；</li>
<li>按照一定频率循环发布消息。</li>
</ul>
<p><strong>具体实现的python代码</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该例程将发布turtle1/cmd_vel话题，消息类型geometry_msgs::Twist</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Twist</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">velocity_publisher</span>():</span><br><span class="line">	<span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;velocity_publisher&#x27;</span>, anonymous=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 创建一个Publisher，发布名为/turtle1/cmd_vel的topic，消息类型为geometry_msgs::Twist，队列长度10</span></span><br><span class="line">    turtle_vel_pub = rospy.Publisher(<span class="string">&#x27;/turtle1/cmd_vel&#x27;</span>, Twist, queue_size=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 设置循环的频率</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">10</span>) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">		<span class="comment"># 初始化geometry_msgs::Twist类型的消息</span></span><br><span class="line">        vel_msg = Twist()</span><br><span class="line">        vel_msg.linear.x = <span class="number">0.5</span></span><br><span class="line">        vel_msg.angular.z = <span class="number">0.2</span></span><br><span class="line"></span><br><span class="line">		<span class="comment"># 发布消息</span></span><br><span class="line">        turtle_vel_pub.publish(vel_msg)</span><br><span class="line">    	rospy.loginfo(<span class="string">&quot;Publsh turtle velocity command[%0.2f m/s, %0.2f rad/s]&quot;</span>, </span><br><span class="line">				vel_msg.linear.x, vel_msg.angular.z)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 按照循环频率延时</span></span><br><span class="line">        rate.sleep()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        velocity_publisher()</span><br><span class="line">    <span class="keyword">except</span> rospy.ROSInterruptException:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="2-4-编译并运行发布者">2.4 编译并运行发布者</h3>
<p>编译具体操作如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make   <span class="comment"># 用该指令进行编译</span></span><br><span class="line"><span class="built_in">source</span> devel/setup.bash   <span class="comment"># 设置环境变量，可以将该句程序放入.bashrc文件的最后一行</span></span><br><span class="line">roscore</span><br><span class="line">rosrun turtlesim turtlesim_node</span><br><span class="line">rosrun learning_topic velocity_publisher <span class="comment"># 运行learning_topic文件中的velocity_publisher节点</span></span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/hzcQkKZFwBvP3pH.png" alt="image-20220108234447167"></p>
<p>python文件放在scripts文件夹中，同时注意要设置python文件具有可执行文件。</p>
<p><img src="https://vip2.loli.io/2023/03/13/ItZwVRczbSDnqCG.png" alt="image-20220109001406674"></p>
<h2 id="3-订阅者Subscriber的编程实现">3. 订阅者Subscriber的编程实现</h2>
<p>订阅者编程实现原理图：</p>
<p><img src="https://vip2.loli.io/2023/03/13/uknUS8toJce4Iva.png" alt="image-20220109002944532"></p>
<h3 id="3-1-配置发布者代码编译规则">3.1 配置发布者代码编译规则</h3>
<p><strong>如何配置CMakeLists.txt中的编译规则：</strong></p>
<ul>
<li>设置需要编译的代码和生成的可执行文件；</li>
<li>设置链接库</li>
</ul>
<p>在<code>~/catkin_ws/src/learning_topic</code>文件夹下的<code>CMakeLists.txt</code>文件中加入如下代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_executable(pose_subscriber src/pose_subscriber.cpp) <span class="comment"># 将src/pose_subscriber.cpp编译成名为pose_subscriber的可执行文件</span></span><br><span class="line">target_link_libraries(pose_subscriber <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>) <span class="comment"># 将可执行文件pose_subscriber和ROS相关的库做一个链接，比如C++的接口</span></span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/oVTUtKCMJXHjWk3.png" alt="image-20220109010041310"></p>
<h3 id="3-2-用C-python实现订阅者">3.2 用C++/python实现订阅者</h3>
<p><strong>C++代码实现一个订阅者</strong>：</p>
<ul>
<li>初始化ROS节点；</li>
<li>订阅需要的话题；</li>
<li>循环等待话题消息，接收到消息后进入回调函数；</li>
<li>在回调函数中完成消息处理。</li>
</ul>
<p><strong>具体实现的C++代码</strong>：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将订阅/turtle1/pose话题，消息类型turtlesim::Pose，这是小海龟仿真器自己定义的信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;turtlesim/Pose.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收到订阅的消息后，会进入消息回调函数，turtlesim::Pose是消息的结构，后面的ConstPtr调用的是长指针</span></span><br><span class="line"><span class="comment">//当msg数据传输过来的时候，就以长指针的形式指向turtlesim::Pose这个姿态信息的数据内容</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poseCallback</span><span class="params">(<span class="type">const</span> turtlesim==Pose==ConstPtr&amp; msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 将接收到的消息打印出来</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Turtle pose: x:%0.6f, y:%0.6f&quot;</span>, msg-&gt;x, msg-&gt;y); <span class="comment">//输出海龟的信息</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;pose_subscriber&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个Subscriber这个类，创建一个pose_sub这个对象，订阅名为/turtle1/pose的topic，需要和turtlesim相对应，注册回调函数poseCallback</span></span><br><span class="line">    <span class="comment">//其中10为订阅话题的队列长度，poseCallback为回调函数，因为数据不知道什么时候发送过来，因此有回调函数，当有数据进来，就调用回调函数进行处理</span></span><br><span class="line">    ros::Subscriber pose_sub = n.<span class="built_in">subscribe</span>(<span class="string">&quot;/turtle1/pose&quot;</span>, <span class="number">10</span>, poseCallback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数，死循环，不断查看队列中是否有数据过来，如果有则进入poseCallback进行处理，如果没有则不断地死循环</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>python代码实现一个订阅者</strong>：</p>
<ul>
<li>初始化ROS节点；</li>
<li>订阅需要的话题；</li>
<li>循环等待话题消息，接收到消息后进入回调函数；</li>
<li>在回调函数中完成消息处理。</li>
</ul>
<p><strong>具体实现的python代码</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该例程将订阅/turtle1/pose话题，消息类型turtlesim::Pose</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> turtlesim.msg <span class="keyword">import</span> Pose</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">poseCallback</span>(<span class="params">msg</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;Turtle pose: x:%0.6f, y:%0.6f&quot;</span>, msg.x, msg.y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pose_subscriber</span>():</span><br><span class="line">	<span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;pose_subscriber&#x27;</span>, anonymous=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 创建一个Subscriber，订阅名为/turtle1/pose的topic，注册回调函数poseCallback</span></span><br><span class="line">    rospy.Subscriber(<span class="string">&quot;/turtle1/pose&quot;</span>, Pose, poseCallback)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 循环等待回调函数</span></span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pose_subscriber()</span><br></pre></td></tr></table></figure>
<p>python可以不用编译，直接可以运行。</p>
<h3 id="3-3-编译并运行发布者">3.3 编译并运行发布者</h3>
<p>编译具体操作如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make   <span class="comment"># 用该指令进行编译</span></span><br><span class="line"><span class="built_in">source</span> devel/setup.bash   <span class="comment"># 设置环境变量，可以将该句程序放入.bashrc文件的最后一行</span></span><br><span class="line">roscore</span><br><span class="line">rosrun turtlesim turtlesim_node</span><br><span class="line">rosrun learning_topic velocity_subscriber<span class="comment">#运行learning_topic文件中的velocity_subscriber节点,如果小海龟不移动，则订阅的小海龟的位置不变。</span></span><br><span class="line">rosrun turtlesim turtle_teleop_key <span class="comment"># 运行键盘遥控节点，控制小海龟移动，可以看到订阅的小海龟位置发生改变</span></span><br></pre></td></tr></table></figure>
<h2 id="4-话题消息的定义与使用">4. 话题消息的定义与使用</h2>
<h3 id="4-1-自定义消息文件的配置">4.1 自定义消息文件的配置</h3>
<p><strong>步骤一：定义msg文件</strong></p>
<p>在<code>learning_topic</code>文件夹中创建<code>msg</code>文件夹，跟消息相关定义都存放在<code>msg</code>文件夹中，方便管理，创建文件<code>person.msg</code>，打开文件，将下列文件放入<code>person.msg</code>文件中。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">string name</span><br><span class="line">uint8 sex</span><br><span class="line">uint8 age</span><br><span class="line"></span><br><span class="line">uint8 unknown = <span class="number">0</span></span><br><span class="line">uint8 male    = <span class="number">1</span></span><br><span class="line">uint8 female  = <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p><strong>步骤二：在package.xml中添加功能包依赖</strong></p>
<p>在<code>learning_topic</code>文件夹中打开<code>package.xml</code>文件，添加下面的语句</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>一个是编译依赖，编译依赖是一个动态产生message的功能包；一个是执行依赖，执行依赖是一个执行message的功能包。如下图：</p>
<p><img src="https://vip2.loli.io/2023/03/13/e29H7xKyvX3cPm1.png" alt="image-20220109143133953"></p>
<p><strong>步骤三：在CMakeLists.txt添加编译选项</strong></p>
<ul>
<li>find_package(……  message_generation)</li>
<li>add_message_files(FILES Person.msg)    将定义的Person.msg作为接口，针对其来进行编译</li>
</ul>
<p>​		generate_messages(DEPENDENCIES std_msgs)    编译Person.msg需要ROS已有的库或者包，需要依赖std_msgs</p>
<ul>
<li>catkin_package(……  message_runtime)    创建message运行依赖</li>
</ul>
<p>分别对应CMakeLists.txt文件中的内容为：</p>
<p><img src="https://vip2.loli.io/2023/03/13/7fu93b6YQDGvRFn.png" alt="image-20220109143527394"></p>
<p><img src="https://vip2.loli.io/2023/03/13/UHa1WuT2AVNIxpo.png" alt="image-20220109144602025"></p>
<p><img src="https://vip2.loli.io/2023/03/13/qW41ksztpO3u6hV.png" alt="image-20220109145204729"></p>
<p><strong>步骤四：编译生成语言相关文件</strong></p>
<p>在工作空间的根目录<code>catkin_ws</code>下通过<code>catkin_make</code>进行编译，生成Person.h头文件。</p>
<p><img src="https://vip2.loli.io/2023/03/13/udlmAP5y4Fq1MgC.png" alt="image-20220109150648353"></p>
<h3 id="4-2-话题消息的使用">4.2 话题消息的使用</h3>
<p>如何根据上面4.1生成的<code>Person.h</code>头文件，通过程序来使用它，具体操作步骤如下：</p>
<p>在src文件夹中创建cpp文件</p>
<h4 id="4-2-1-C-代码实现发布者">4.2.1 C++代码实现发布者</h4>
<ul>
<li>初始化ROS节点；</li>
<li>向ROS Master注册节点信息，包括发布的话题名和话题中的消息类型；</li>
<li>创建消息数据；</li>
<li>按照一定频率循环发布消息。</li>
</ul>
<p><strong>具体实现的C++代码</strong>：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将发布/person_info话题，自定义消息类型learning_topic::Person</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;learning_topic/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ROS节点初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;person_publisher&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个Publisher，发布名为/person_info的topic，消息类型为learning_topic::Person，队列长度10</span></span><br><span class="line">    ros==Publisher person_info_pub = n.<span class="built_in">advertise</span>&lt;learning_topic==Person&gt;(<span class="string">&quot;/person_info&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置循环的频率</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 初始化learning_topic::Person类型的消息</span></span><br><span class="line">    	learning_topic::Person person_msg;</span><br><span class="line">		person_msg.name = <span class="string">&quot;Tom&quot;</span>;</span><br><span class="line">		person_msg.age  = <span class="number">18</span>;</span><br><span class="line">		person_msg.sex  = learning_topic==Person==male;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发布消息</span></span><br><span class="line">		person_info_pub.<span class="built_in">publish</span>(person_msg);</span><br><span class="line"></span><br><span class="line">       	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Publish Person Info: name:%s  age:%d  sex:%d&quot;</span>, </span><br><span class="line">				  person_msg.name.<span class="built_in">c_str</span>(), person_msg.age, person_msg.sex);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 按照循环频率延时</span></span><br><span class="line">        loop_rate.<span class="built_in">sleep</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-2-2-C-代码实现订阅者">4.2.2 C++代码实现订阅者</h4>
<ul>
<li>初始化ROS节点；</li>
<li>订阅需要的话题；</li>
<li>循环等待话题消息，接收到消息后进入回调函数；</li>
<li>在回调函数中完成消息处理。</li>
</ul>
<p><strong>具体实现的C++代码</strong>：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将订阅/person_info话题，自定义消息类型learning_topic::Person</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;learning_topic/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收到订阅的消息后，会进入消息回调函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">personInfoCallback</span><span class="params">(<span class="type">const</span> learning_topic==Person==ConstPtr&amp; msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 将接收到的消息打印出来</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Subcribe Person Info: name:%s  age:%d  sex:%d&quot;</span>, </span><br><span class="line">			 msg-&gt;name.<span class="built_in">c_str</span>(), msg-&gt;age, msg-&gt;sex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;person_subscriber&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个Subscriber，订阅名为/person_info的topic，注册回调函数personInfoCallback</span></span><br><span class="line">    ros::Subscriber person_info_sub = n.<span class="built_in">subscribe</span>(<span class="string">&quot;/person_info&quot;</span>, <span class="number">10</span>, personInfoCallback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-2-3-编译配置文件">4.2.3  编译配置文件</h4>
<p>添加订阅者和发布者相关程序后，需要对CMakeList_List.txt文件进行配置</p>
<p>配置<code>CMakeLists.txt中</code>的编译规则：</p>
<ul>
<li>设置需要编译的代码和生成的可执行文件；</li>
<li>设置链接库；</li>
<li>添加依赖项。</li>
</ul>
<p>在<code>catkin_ws/src/learning_topic</code>文件夹下的<code>CMakeList_List.txt</code>文件中加入以下代码：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">add_executable(person_publisher src/person_publisher.cpp)</span><br><span class="line">target_link_libraries(person_publisher $&#123;catkin_LIBRARIES&#125;)</span><br><span class="line">add_dependencies(person_publisher $&#123;PROJECT_NAME&#125;_generate_messages_cpp)</span><br><span class="line"></span><br><span class="line">add_executable(person_subscriber src/person_subscriber.cpp)</span><br><span class="line">target_link_libraries(person_subscriber $&#123;catkin_LIBRARIES&#125;)</span><br><span class="line">add_dependencies(person_subscriber $&#123;PROJECT_NAME&#125;_generate_messages_cpp)</span><br></pre></td></tr></table></figure>
<p>有一些代码是动态生成的，需要将可执行文件和动态生成的程序产生依赖关系，因此需要通过<code>add_dependencies</code>命令来做一些连接。要和自己自定义的消息进行连接必须要添加这样一行代码。如图所示：</p>
<p><img src="https://vip2.loli.io/2023/03/13/9gh3G7AZmzuBCY8.png" alt="image-20220109153302090"></p>
<p>在工作空间的根目录<code>catkin_ws</code>下，通过<code>catkin_make</code>进行编译。</p>
<p>ROS Master是帮助节点之间创建连接，一旦两者创建连接后，关闭<code>roscore</code>，publisher和subscriber依然发布消息和订阅消息，此时ROS Master不再起作用。</p>
<h4 id="4-2-4-python代码实现">4.2.4 python代码实现</h4>
<p>发布者python实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该例程将发布/person_info话题，自定义消息类型learning_topic::Person</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> learning_topic.msg <span class="keyword">import</span> Person   <span class="comment"># 对应的msg文件也生成了python文件，通过import形式引入进来</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">velocity_publisher</span>():</span><br><span class="line">	<span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;person_publisher&#x27;</span>, anonymous=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 创建一个Publisher，发布名为/person_info的topic，消息类型为learning_topic::Person，队列长度10</span></span><br><span class="line">    person_info_pub = rospy.Publisher(<span class="string">&#x27;/person_info&#x27;</span>, Person, queue_size=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 设置循环的频率</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">10</span>) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">		<span class="comment"># 初始化learning_topic::Person类型的消息</span></span><br><span class="line">    	person_msg = Person()</span><br><span class="line">    	person_msg.name = <span class="string">&quot;Tom&quot;</span>;</span><br><span class="line">    	person_msg.age  = <span class="number">18</span>;</span><br><span class="line">    	person_msg.sex  = Person.male;</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 发布消息</span></span><br><span class="line">        person_info_pub.publish(person_msg)</span><br><span class="line">    	rospy.loginfo(<span class="string">&quot;Publsh person message[%s, %d, %d]&quot;</span>, </span><br><span class="line">				person_msg.name, person_msg.age, person_msg.sex)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 按照循环频率延时</span></span><br><span class="line">        rate.sleep()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        velocity_publisher()</span><br><span class="line">    <span class="keyword">except</span> rospy.ROSInterruptException:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>订阅者python实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该例程将订阅/person_info话题，自定义消息类型learning_topic::Person</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> learning_topic.msg <span class="keyword">import</span> Person</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">personInfoCallback</span>(<span class="params">msg</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;Subcribe Person Info: name:%s  age:%d  sex:%d&quot;</span>, </span><br><span class="line">			 msg.name, msg.age, msg.sex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">person_subscriber</span>():</span><br><span class="line">	<span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;person_subscriber&#x27;</span>, anonymous=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 创建一个Subscriber，订阅名为/person_info的topic，注册回调函数personInfoCallback</span></span><br><span class="line">    rospy.Subscriber(<span class="string">&quot;/person_info&quot;</span>, Person, personInfoCallback)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 循环等待回调函数</span></span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    person_subscriber()</span><br></pre></td></tr></table></figure>
<h2 id="5-客户端Client的编程实现">5. 客户端Client的编程实现</h2>
<p>客户端Client编程实现原理图：</p>
<p><img src="https://vip2.loli.io/2023/03/13/I375BL9bwA8QJeu.png" alt="image-20220109162256828"></p>
<h3 id="5-1创建功能包">5.1创建功能包</h3>
<p>代码实现如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws/src</span><br><span class="line">catkin_create_pkg learning_service roscpp rospy std_msgs geometry_msgs turtlesim</span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/XEJbFPGeKhvWZLu.png" alt="image-20220109162826338"></p>
<p><img src="https://vip2.loli.io/2023/03/13/8eJc7oUq2nYPvsO.png" alt="image-20220109162908264"></p>
<h3 id="5-2-C-python代码实现客户端">5.2 C++/python代码实现客户端</h3>
<h4 id="5-2-1-C-代码实现客户端">5.2.1 C++代码实现客户端</h4>
<p>在learning_service文件夹下的src文件中，新建turtle_spawn.cpp文件，实现流程如下：</p>
<ul>
<li>初始化ROS节点；</li>
<li>创建一个Client实例；</li>
<li>发布服务请求数据；</li>
<li>等待Server处理之后的应答结果。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将请求/spawn服务，服务数据类型turtlesim::Spawn</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;turtlesim/Spawn.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;turtle_spawn&quot;</span>); <span class="comment">//节点名为spawn</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">	ros::NodeHandle node;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发现/spawn服务后，创建一个服务客户端，连接名为/spawn的service</span></span><br><span class="line">	ros==service==<span class="built_in">waitForService</span>(<span class="string">&quot;/spawn&quot;</span>);  <span class="comment">//循环等待spawn这样一个服务，是一个阻塞式的服务，只有服务在系统中存在了，才能请求这个服务</span></span><br><span class="line">	ros==ServiceClient add_turtle = node.<span class="built_in">serviceClient</span>&lt;turtlesim==Spawn&gt;(<span class="string">&quot;/spawn&quot;</span>);<span class="comment">//创建客户端ServiceClient</span></span><br><span class="line">    <span class="comment">//客户端用来给spawn服务发送请求，请求的数据类型为turtlesim::Spawn，/spawn代表服务的名字。    </span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化turtlesim::Spawn的请求数据</span></span><br><span class="line">	turtlesim::Spawn srv;  <span class="comment">//定义srv</span></span><br><span class="line">	srv.request.x = <span class="number">2.0</span>;   <span class="comment">//海龟的x轴坐标</span></span><br><span class="line">	srv.request.y = <span class="number">2.0</span>;   <span class="comment">//海龟的y轴坐标，没有角速度</span></span><br><span class="line">	srv.request.name = <span class="string">&quot;turtle2&quot;</span>; <span class="comment">//海龟的名字</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请求服务调用，发一个日志，告诉终端已经准备好这个请求了</span></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Call service to spwan turtle[x:%0.6f, y:%0.6f, name:%s]&quot;</span>, </span><br><span class="line">			 srv.request.x, srv.request.y, srv.request.name.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">	add_turtle.<span class="built_in">call</span>(srv);<span class="comment">//请求的方法用call，call也是阻塞性函数，把request发出去后一直在等待服务器给反馈</span></span><br><span class="line">    <span class="comment">//如果一直等待超过call的时间，会提示超时</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 显示服务调用结果</span></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Spwan turtle successfully [name:%s]&quot;</span>, srv.response.name.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="5-2-2-python代码实现客户端">5.2.2 python代码实现客户端</h4>
<p>在learning_service文件夹下的src文件中，新建turtle_spawn.cpp文件，实现流程如下：</p>
<ul>
<li>初始化ROS节点；</li>
<li>创建一个Client实例；</li>
<li>发布服务请求数据；</li>
<li>等待Server处理之后的应答结果。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该例程将请求/spawn服务，服务数据类型turtlesim::Spawn</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> turtlesim.srv <span class="keyword">import</span> Spawn</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">turtle_spawn</span>():</span><br><span class="line">	<span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;turtle_spawn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 发现/spawn服务后，创建一个服务客户端，连接名为/spawn的service</span></span><br><span class="line">    rospy.wait_for_service(<span class="string">&#x27;/spawn&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        add_turtle = rospy.ServiceProxy(<span class="string">&#x27;/spawn&#x27;</span>, Spawn)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 请求服务调用，输入请求数据</span></span><br><span class="line">        response = add_turtle(<span class="number">2.0</span>, <span class="number">2.0</span>, <span class="number">0.0</span>, <span class="string">&quot;turtle2&quot;</span>)<span class="comment">##x轴坐标、y轴坐标、角度值、海龟的名字</span></span><br><span class="line">        <span class="keyword">return</span> response.name</span><br><span class="line">    <span class="keyword">except</span> rospy.ServiceException, e:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Service call failed: %s&quot;</span>%e</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	<span class="comment"># 服务调用并显示调用结果</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;Spwan turtle successfully [name:%s]&quot;</span> %(turtle_spawn())</span><br></pre></td></tr></table></figure>
<h3 id="5-3-配置客户端代码编译规则">5.3 配置客户端代码编译规则</h3>
<p>如何配置<code>CMakeLists.txt</code>中的编译规则</p>
<ul>
<li>设置需要编译的代码和生成的可执行文件</li>
<li>设置链接库</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_executable(turtle_spawn src/turtle_spawn.cpp)  //将turtle_spawn.cpp文件编译成turtle_spawn的可执行文件</span><br><span class="line">target_link_libraries(turtle_spawn $&#123;catkin_LIBRARIES&#125;)  //将turtle_spawn链接到ROS对应的库</span><br></pre></td></tr></table></figure>
<h3 id="5-4-编译并运行客户端">5.4 编译并运行客户端</h3>
<p>回到工作空间的根目录<code>catkin_ws</code>文件夹下，通过<code>catkin_make</code>进行编译。</p>
<p><img src="https://vip2.loli.io/2023/03/13/UOfBI6FKLCm9GeP.png" alt="image-20220109173743981"></p>
<p>在<code>catkin_ws/devel/lib</code>文件夹下产生的<code>learning_service</code>文件夹就是编译后产生的，里面的<code>turtle_spawn</code>文件就是编译产生的可执行文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make</span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">roscore</span><br><span class="line">rosrun turtlesim turtlesim_node</span><br><span class="line">rosrun learning_service turtle_spawn</span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/PtQmqkRWNx6DHI2.png" alt="image-20220109174700615"></p>
<p><img src="https://vip2.loli.io/2023/03/13/Po7h1aQr6VUJIHN.png" alt="image-20220109174536473"></p>
<p><strong>注意</strong>：要将python文件的权限选择允许作为程序执行文件，如下所示。</p>
<p><img src="https://vip2.loli.io/2023/03/13/y7plz98hiPtFOnW.png" alt="image-20220109175841987"></p>
<h2 id="6-服务端Server的编程实现">6. 服务端Server的编程实现</h2>
<p>服务端Server编程实现原理图：</p>
<p><img src="https://vip2.loli.io/2023/03/13/PjMR357A9ua8ter.png" alt="image-20220109180341410"></p>
<h3 id="6-1-用C-python实现一个服务器">6.1 用C++/python实现一个服务器</h3>
<h4 id="6-1-1-用C-实现一个服务器">6.1.1 用C++实现一个服务器</h4>
<p>在learning_service文件夹下的src文件中，新建turtle_command_server.cpp文件，实现流程如下：</p>
<ul>
<li>初始化ROS节点；</li>
<li>创建一个Server实例；</li>
<li>循环等待服务请求，进入回调函数；</li>
<li>在回调函数中完成服务功能的处理，并反馈应答数据。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将执行/turtle_command服务，服务数据类型std_srvs/Trigger</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;geometry_msgs/Twist.h&gt;</span>  <span class="comment">//topic的头文件Twist</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;std_srvs/Trigger.h&gt;</span> <span class="comment">//服务数据类型的头文件Trigger</span></span></span><br><span class="line"></span><br><span class="line">ros::Publisher turtle_vel_pub;  <span class="comment">//全局的publisher</span></span><br><span class="line"><span class="type">bool</span> pubCommand = <span class="literal">false</span>;  <span class="comment">//作为标志位，标志海龟是运动还是停止，false是停止</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// service回调函数，输入参数req，输出参数res</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">commandCallback</span><span class="params">(std_srvs==Trigger==Request  &amp;req,</span></span></span><br><span class="line"><span class="params"><span class="function">         			std_srvs==Trigger==Response &amp;res)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	pubCommand = !pubCommand;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示请求数据</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Publish turtle velocity command [%s]&quot;</span>, pubCommand==<span class="literal">true</span>?<span class="string">&quot;Yes&quot;</span>:<span class="string">&quot;No&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置反馈数据</span></span><br><span class="line">	res.success = <span class="literal">true</span>;</span><br><span class="line">	res.message = <span class="string">&quot;Change turtle command state!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ROS节点初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;turtle_command_server&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个名为/turtle_command的server，注册回调函数commandCallback，实例为command_service，定义service的名字为turtle_command</span></span><br><span class="line">    <span class="comment">//类似订阅者，因为不知道数据什么时候过来，通过回调函数commandCallback来处理request，即一旦service收到request之后立刻跳到回调函数里面</span></span><br><span class="line">    <span class="comment">//在回调函数里面再做针对server的处理</span></span><br><span class="line">    ros::ServiceServer command_service = n.<span class="built_in">advertiseService</span>(<span class="string">&quot;/turtle_command&quot;</span>, commandCallback);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建一个Publisher，发布名为/turtle1/cmd_vel的topic，消息类型为geometry_msgs::Twist，队列长度10</span></span><br><span class="line">	turtle_vel_pub = n.<span class="built_in">advertise</span>&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;/turtle1/cmd_vel&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Ready to receive turtle command.&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置循环的频率</span></span><br><span class="line">	<span class="function">ros::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">10</span>)</span></span>;<span class="comment">//进行一秒钟10Hz来做topic的发布</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(ros::<span class="built_in">ok</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 查看一次回调函数队列</span></span><br><span class="line">    	ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 如果标志为true，则发布速度指令</span></span><br><span class="line">		<span class="keyword">if</span>(pubCommand)</span><br><span class="line">		&#123;</span><br><span class="line">			geometry_msgs::Twist vel_msg;</span><br><span class="line">			vel_msg.linear.x = <span class="number">0.5</span>;</span><br><span class="line">			vel_msg.angular.z = <span class="number">0.2</span>;</span><br><span class="line">			turtle_vel_pub.<span class="built_in">publish</span>(vel_msg);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//按照循环频率延时</span></span><br><span class="line">	    loop_rate.<span class="built_in">sleep</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-1-2-用python实现一个服务器">6.1.2 用python实现一个服务器</h4>
<p>在python程序中没有spinOnce这条指令，通过python中的多线程指令来完成标志位是True还是False。</p>
<p>在learning_service文件夹下的scripts文件中，新建turtle_command_server.py文件，实现流程如下：</p>
<ul>
<li>初始化ROS节点；</li>
<li>创建一个Server实例；</li>
<li>循环等待服务请求，进入回调函数；</li>
<li>在回调函数中完成服务功能的处理，并反馈应答数据。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该例程将执行/turtle_command服务，服务数据类型std_srvs/Trigger</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> thread,time</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Twist</span><br><span class="line"><span class="keyword">from</span> std_srvs.srv <span class="keyword">import</span> Trigger, TriggerResponse</span><br><span class="line"></span><br><span class="line">pubCommand = <span class="literal">False</span>;</span><br><span class="line">turtle_vel_pub = rospy.Publisher(<span class="string">&#x27;/turtle1/cmd_vel&#x27;</span>, Twist, queue_size=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">command_thread</span>():	</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:     <span class="comment"># 如果是True就继续，如果是False就跳过</span></span><br><span class="line">		<span class="keyword">if</span> pubCommand:</span><br><span class="line">			vel_msg = Twist()</span><br><span class="line">			vel_msg.linear.x = <span class="number">0.5</span></span><br><span class="line">			vel_msg.angular.z = <span class="number">0.2</span></span><br><span class="line">			turtle_vel_pub.publish(vel_msg)</span><br><span class="line">			</span><br><span class="line">		time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">commandCallback</span>(<span class="params">req</span>):</span><br><span class="line">	<span class="keyword">global</span> pubCommand</span><br><span class="line">	pubCommand = <span class="built_in">bool</span>(<span class="number">1</span>-pubCommand)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 显示请求数据</span></span><br><span class="line">	rospy.loginfo(<span class="string">&quot;Publish turtle velocity command![%d]&quot;</span>, pubCommand)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 反馈数据</span></span><br><span class="line">	<span class="keyword">return</span> TriggerResponse(<span class="number">1</span>, <span class="string">&quot;Change turtle command state!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">turtle_command_server</span>():</span><br><span class="line">	<span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;turtle_command_server&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 创建一个名为/turtle_command的server，注册回调函数commandCallback</span></span><br><span class="line">    s = rospy.Service(<span class="string">&#x27;/turtle_command&#x27;</span>, Trigger, commandCallback)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 循环等待回调函数</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;Ready to receive turtle command.&quot;</span></span><br><span class="line"></span><br><span class="line">    thread.start_new_thread(command_thread, ())</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    turtle_command_server()</span><br></pre></td></tr></table></figure>
<h3 id="6-2-配置服务器代码编译规则">6.2 配置服务器代码编译规则</h3>
<p>如何配置<code>CMakeList.txt</code>中的编译规则：</p>
<ul>
<li>设置需要编译的代码和生成的可执行文件；</li>
<li>设置链接库。</li>
</ul>
<p>将下面的规则加入CMakeList.txt中：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_executable(turtle_command_server src/turtle_command_server.cpp)</span><br><span class="line">target_link_libraries(turtle_command_server $&#123;catkin_LIBRARIES&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/XoRenuDF458E3hy.png" alt="image-20220109192708646"></p>
<h3 id="6-3-编译并运行服务器">6.3 编译并运行服务器</h3>
<h4 id="6-3-1-编译运行C-程序">6.3.1 编译运行C++程序</h4>
<p>编译运行流程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make</span><br><span class="line"><span class="built_in">source</span> devel/setup.bash  <span class="comment"># 如果不想每次source，则需要在.bashrc中添加一行代码：source /home/yww/catkin_ws/devel/setup.bash</span></span><br><span class="line">roscore</span><br><span class="line">rosrun turtlesim turtlesim_node</span><br><span class="line">rosrun learning_service turtle_command_server</span><br><span class="line">rosservice call/turtle_command <span class="string">&quot;&#123;&#125;&quot;</span> <span class="comment">#&#123;&#125;里面的内容是request的内容，是空的，</span></span><br></pre></td></tr></table></figure>
<p>输入后的效果：</p>
<p><img src="https://vip2.loli.io/2023/03/13/fxuYL7aRTzOeoFt.png" alt="image-20220109194230634"></p>
<p>再一次最后一行命令的效果：</p>
<p><img src="https://vip2.loli.io/2023/03/13/italRSYCeoLwjQP.png" alt="image-20220109194523039"></p>
<p><img src="https://vip2.loli.io/2023/03/13/IOaQmGNPbh9c2X5.png" alt="image-20220109194633759"></p>
<h4 id="6-3-2-编译运行python程序">6.3.2 编译运行python程序</h4>
<p>编译运行流程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make</span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">roscore</span><br><span class="line">rosrun turtlesim turtlesim_node</span><br><span class="line">rosrun learning_service turtle_command_server.py</span><br><span class="line">rosservice call/turtle_command <span class="string">&quot;&#123;&#125;&quot;</span> <span class="comment">#&#123;&#125;里面的内容是request的内容，是空的，</span></span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/3htKFXcLkvoCpl1.png" alt="image-20220109200517280"></p>
<h2 id="7-服务数据的定义和使用">7. 服务数据的定义和使用</h2>
<p>服务模型的结构图：</p>
<p><img src="https://vip2.loli.io/2023/03/13/EYZXke6VHWzq1QT.png" alt="image-20220109234711913"></p>
<h3 id="7-1-如何自定义服务数据">7.1 如何自定义服务数据</h3>
<p><strong>步骤一：定义srv文件</strong></p>
<p>打开<code>catkin_ws/src/learning_service/srv</code>文件夹，创建<code>Person.srv</code>文件，打开，并输入以下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">string  name</span><br><span class="line">uint8   age</span><br><span class="line">uint8   sex</span><br><span class="line"></span><br><span class="line">uint8   unknown = 0</span><br><span class="line">uint8   male    = 1</span><br><span class="line">uint8   female  = 2</span><br><span class="line">---</span><br><span class="line">string result</span><br></pre></td></tr></table></figure>
<p>在<code>---</code>上面是<code>request</code>，在<code>---</code>下面是<code>response</code>。</p>
<p><strong>步骤二：在package.xml中添加功能包依赖</strong></p>
<p>打开<code>catkin_ws/src/learning_service</code>文件夹中打开<code>package.xml</code>文件，将下面的代码加入其中：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/czYhETmyweR7kHn.png" alt="image-20220110000303130"></p>
<p><strong>步骤三：在CMakeLists.txt添加编译选项</strong></p>
<p>打开<code>catkin_ws/src/learning_service</code>文件夹中打开CMakeLists.txt文件中做如下修改</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">find_package(... message_generation)</span><br><span class="line"></span><br><span class="line">add_service_files(FILES Person.srv)</span><br><span class="line">generate_messages(DEPENDENCIES std_msgs)</span><br><span class="line"></span><br><span class="line">catkin_package(... message_runtime)</span><br></pre></td></tr></table></figure>
<p>具体实现的效果如图：</p>
<p><img src="https://vip2.loli.io/2023/03/13/pqE3li6BDVe5auo.png" alt="image-20220110001104459"></p>
<p><img src="https://vip2.loli.io/2023/03/13/yo4kPsgbaXFLOCD.png" alt="image-20220110001211592"></p>
<p><img src="https://vip2.loli.io/2023/03/13/tZOwnVfG74MxivP.png" alt="image-20220110001315761"></p>
<p><strong>步骤四：编译生成语言相关文件</strong></p>
<p>回到工作空间根目录<code>catkin_ws</code>下，通过<code>catkin_make</code>进行编译。</p>
<p>编译后在<code>Person.h</code>文件中包含了<code>PersonRequest.h</code>和<code>PersonResponse.h</code>文件，用的时候包含一个<code>Person.h</code>就可以</p>
<p><img src="https://vip2.loli.io/2023/03/13/DFvZP1CU6RbTMdp.png" alt="image-20220110001845113"></p>
<h3 id="7-2-相关代码实现">7.2 相关代码实现</h3>
<h4 id="7-2-1-C-相关代码实现">7.2.1 C++相关代码实现</h4>
<p><strong>Client端的C++代码编写</strong>：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将请求/show_person服务，服务数据类型learning_service::Person</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;learning_service/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;person_client&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">	ros::NodeHandle node;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发现/spawn服务后，创建一个服务客户端，连接名为/spawn的service</span></span><br><span class="line">	ros==service==<span class="built_in">waitForService</span>(<span class="string">&quot;/show_person&quot;</span>);<span class="comment">//等待show_person服务</span></span><br><span class="line">	ros==ServiceClient person_client = node.<span class="built_in">serviceClient</span>&lt;learning_service==Person&gt;(<span class="string">&quot;/show_person&quot;</span>);</span><br><span class="line">    <span class="comment">//learning_service::Person是自己定义的，数据service的对象是通道/show_person</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化learning_service::Person的请求数据</span></span><br><span class="line">	learning_service::Person srv; <span class="comment">//Person和定义的srv的文件名完全一致</span></span><br><span class="line">	srv.request.name = <span class="string">&quot;Tom&quot;</span>;</span><br><span class="line">	srv.request.age  = <span class="number">20</span>;</span><br><span class="line">	srv.request.sex  = learning_service==Person==Request::male;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请求服务调用</span></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Call service to show person[name:%s, age:%d, sex:%d]&quot;</span>, </span><br><span class="line">			 srv.request.name.<span class="built_in">c_str</span>(), srv.request.age, srv.request.sex);</span><br><span class="line"></span><br><span class="line">	person_client.<span class="built_in">call</span>(srv);<span class="comment">//通过person_client.call把请求数据发出去，然后等待server的反馈结果</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 显示服务调用结果</span></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Show person result : %s&quot;</span>, srv.response.result.<span class="built_in">c_str</span>());<span class="comment">// 反馈收到后，显示反馈结果</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>代码22行中的名字和srv的文件名一致，如下图：</p>
<p><img src="https://vip2.loli.io/2023/03/13/URdnaLYIbSzG5pX.png" alt="image-20220110004537101"></p>
<p><strong>Server端的C++代码编写</strong>：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将执行/show_person服务，服务数据类型learning_service::Person</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;learning_service/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// service回调函数，输入参数req，输出参数res</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">personCallback</span><span class="params">(learning_service==Person==Request  &amp;req,</span></span></span><br><span class="line"><span class="params"><span class="function">         			learning_service==Person==Response &amp;res)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 显示请求数据</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Person: name:%s  age:%d  sex:%d&quot;</span>, req.name.<span class="built_in">c_str</span>(), req.age, req.sex);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置反馈数据</span></span><br><span class="line">	res.result = <span class="string">&quot;OK&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ROS节点初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;person_server&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个名为/show_person的server，注册回调函数personCallback</span></span><br><span class="line">    ros::ServiceServer person_service = n.<span class="built_in">advertiseService</span>(<span class="string">&quot;/show_person&quot;</span>, personCallback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Ready to show person informtion.&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-2-2-python相关代码实现">7.2.2 python相关代码实现</h4>
<p>客户端相关的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################################</span></span><br><span class="line"><span class="comment">####          Copyright 2020 GuYueHome (www.guyuehome.com).          ###</span></span><br><span class="line"><span class="comment">########################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 该例程将请求/show_person服务，服务数据类型learning_service::Person</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> learning_service.srv <span class="keyword">import</span> Person, PersonRequest</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">person_client</span>():</span><br><span class="line">	<span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;person_client&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 发现/spawn服务后，创建一个服务客户端，连接名为/spawn的service</span></span><br><span class="line">    rospy.wait_for_service(<span class="string">&#x27;/show_person&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        person_client = rospy.ServiceProxy(<span class="string">&#x27;/show_person&#x27;</span>, Person)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 请求服务调用，输入请求数据</span></span><br><span class="line">        response = person_client(<span class="string">&quot;Tom&quot;</span>, <span class="number">20</span>, PersonRequest.male)</span><br><span class="line">        <span class="keyword">return</span> response.result</span><br><span class="line">    <span class="keyword">except</span> rospy.ServiceException, e:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Service call failed: %s&quot;</span>%e</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	<span class="comment"># 服务调用并显示调用结果</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;Show person result : %s&quot;</span> %(person_client())</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################################</span></span><br><span class="line"><span class="comment">####          Copyright 2020 GuYueHome (www.guyuehome.com).          ###</span></span><br><span class="line"><span class="comment">########################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 该例程将执行/show_person服务，服务数据类型learning_service::Person</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> learning_service.srv <span class="keyword">import</span> Person, PersonResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">personCallback</span>(<span class="params">req</span>):</span><br><span class="line">	<span class="comment"># 显示请求数据</span></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;Person: name:%s  age:%d  sex:%d&quot;</span>, req.name, req.age, req.sex)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 反馈数据</span></span><br><span class="line">    <span class="keyword">return</span> PersonResponse(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">person_server</span>():</span><br><span class="line">	<span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;person_server&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 创建一个名为/show_person的server，注册回调函数personCallback</span></span><br><span class="line">    s = rospy.Service(<span class="string">&#x27;/show_person&#x27;</span>, Person, personCallback)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 循环等待回调函数</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;Ready to show person informtion.&quot;</span></span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    person_server()</span><br></pre></td></tr></table></figure>
<h3 id="7-3-配置服务器-客户端代码编译规则">7.3 配置服务器/客户端代码编译规则</h3>
<p>配置<code>CMakeLists.txt</code>中的编译规则：</p>
<ul>
<li>设置需要编译的代码和生成的可执行文件；</li>
<li>设置链接库；</li>
<li>添加依赖项，依赖动态生成的cpp文件。</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">add_executable(person_server src/person_server.cpp)</span><br><span class="line">target_link_libraries(person_server $&#123;catkin_LIBRARIES&#125;)</span><br><span class="line">add_dependencies(person_server $&#123;PROJECT_NAME&#125;_gencpp)</span><br><span class="line"></span><br><span class="line">add_executable(person_client src/person_client.cpp)</span><br><span class="line">target_link_libraries(person_client $&#123;catkin_LIBRARIES&#125;)</span><br><span class="line">add_dependencies(person_client $&#123;PROJECT_NAME&#125;_gencpp)</span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/fjQBeEGps6t37r2.png" alt="image-20220110010101564"></p>
<h3 id="7-4-编译并运行发布者和订阅者">7.4 编译并运行发布者和订阅者</h3>
<p>编译运行流程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make</span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">roscore</span><br><span class="line">rosrun learning_service person_server</span><br><span class="line">rosrun learning_service person_client</span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/sHj6VOLxoE7erk5.png" alt="image-20220110010428506"></p>
<p><img src="https://vip2.loli.io/2023/03/13/nkJXecROVPBYdbf.png" alt="image-20220110010845829"></p>
<p>客户端每请求一次服务端显示一次。</p>
<h2 id="8-参数的使用与编程方法">8. 参数的使用与编程方法</h2>
<p>参数模型结构图：</p>
<p><img src="https://vip2.loli.io/2023/03/13/CrBgFfMZkDuasOz.png" alt="image-20220110215606138"></p>
<p>ROS Master中有一个参数服务器Parameter Server，是一个全局字典，用来保存各个节点之间的配置参数，各个节点都可以访问。</p>
<h3 id="8-1-参数模型的使用方法">8.1 参数模型的使用方法</h3>
<p>参数模型实现：</p>
<p>首先创建功能包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws/src</span><br><span class="line">catkin_create_pkg learning_parameter roscpp rospy std_ws</span><br></pre></td></tr></table></figure>
<p>rosparam命令行的使用方式：</p>
<p><code>rosparam list</code> 列出当前有多少参数</p>
<p><code>rosparam get param_key</code> 显示某个参数值</p>
<p><code>rosparam set param_key param_value </code> 设置某个参数值</p>
<p><code>rosparam dump file_name</code> 保存参数到文件</p>
<p><code>rosparam load file_name </code> 从文件读取参数</p>
<p><code>rosparam delete param_key</code> 删除参数</p>
<p><code>rosparam</code> 通过rosparam可以看到对该句命令的解释</p>
<p><img src="https://vip2.loli.io/2023/03/13/lhvQWdw8B9IgrSJ.png" alt="image-20220110220808769"></p>
<p>以小海龟案例为例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">roscore</span><br><span class="line">rosrun turtlesim turtlesim_node</span><br><span class="line">rosparam list</span><br></pre></td></tr></table></figure>
<p>可以显示如下：</p>
<p><img src="https://vip2.loli.io/2023/03/13/Ziud3seSpWjvgUP.png" alt="image-20220110222413859"></p>
<p>background_b、background_g、background_r是小海龟背景的颜色值</p>
<p>rosdistro是当前的ros是Melodic</p>
<p>rosversion是小海龟当前的版本</p>
<p>run_id为进程的id号</p>
<p>如果想得到某个参数的值，可以通过<code>rosparam get /background_b</code>获得：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosparam get /background_b</span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/bpx7kB12YzO6vDC.png" alt="image-20220110223202858"></p>
<p>如果想修改某个参数的值，可以通过<code>rosparam set /background_b</code>修改：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosparam <span class="built_in">set</span> /background_b 100</span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/cmnTU7jh5zDME1J.png" alt="image-20220110224131388"></p>
<p>需要发送一个请求才能把小海龟背景颜色给改变：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosservice call /clear <span class="string">&quot;&#123;&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<p>这个请求的服务名字为clear，发送空即可，发送请求后仿真器会查询rgb值，如果有更改，会根据新的值刷新背景颜色。</p>
<p><img src="https://vip2.loli.io/2023/03/13/OEMB9UwDqVCg35A.png" alt="image-20220110224737789"></p>
<p>保存ros系统的参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosparam dump yww_param.yaml</span><br></pre></td></tr></table></figure>
<p>回车之后会自动保存为<code>yww_param.yaml</code>文件，没有任何提示。</p>
<p>也可以更改<code>yww_param.yaml</code>中的数据，然后用以下命令进行加载：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosparam load yww_param.yaml</span><br></pre></td></tr></table></figure>
<p>修改好之后通过获取<code>rosparam get /background_b</code>之后的值。</p>
<h3 id="8-2-用C-python实现参数的使用">8.2 用C++/python实现参数的使用</h3>
<h4 id="8-2-1-用C-实现参数的使用">8.2.1 用C++实现参数的使用</h4>
<p>通过以下代码实现：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws/src/learning_parameter/src</span><br><span class="line"><span class="built_in">touch</span> parameter_config.cpp</span><br></pre></td></tr></table></figure>
<p>其中<code>parameter_config.cpp</code>代码的结构为：</p>
<ul>
<li>初始化ROS节点；</li>
<li>get函数获取参数；</li>
<li>set函数设置参数。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程设置/读取海龟例程中的参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;std_srvs/Empty.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> red, green, blue;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ROS节点初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;parameter_config&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle node;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取背景颜色参数</span></span><br><span class="line">	ros==param==<span class="built_in">get</span>(<span class="string">&quot;/background_r&quot;</span>, red);</span><br><span class="line">	ros==param==<span class="built_in">get</span>(<span class="string">&quot;/background_g&quot;</span>, green);</span><br><span class="line">	ros==param==<span class="built_in">get</span>(<span class="string">&quot;/background_b&quot;</span>, blue);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Get Backgroud Color[%d, %d, %d]&quot;</span>, red, green, blue);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置背景颜色参数</span></span><br><span class="line">	ros==param==<span class="built_in">set</span>(<span class="string">&quot;/background_r&quot;</span>, <span class="number">255</span>);</span><br><span class="line">	ros==param==<span class="built_in">set</span>(<span class="string">&quot;/background_g&quot;</span>, <span class="number">255</span>);</span><br><span class="line">	ros==param==<span class="built_in">set</span>(<span class="string">&quot;/background_b&quot;</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Set Backgroud Color[255, 255, 255]&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取背景颜色参数</span></span><br><span class="line">	ros==param==<span class="built_in">get</span>(<span class="string">&quot;/background_r&quot;</span>, red);</span><br><span class="line">	ros==param==<span class="built_in">get</span>(<span class="string">&quot;/background_g&quot;</span>, green);</span><br><span class="line">	ros==param==<span class="built_in">get</span>(<span class="string">&quot;/background_b&quot;</span>, blue);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Re-get Backgroud Color[%d, %d, %d]&quot;</span>, red, green, blue);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 调用服务，刷新背景颜色</span></span><br><span class="line">	ros==service==<span class="built_in">waitForService</span>(<span class="string">&quot;/clear&quot;</span>);</span><br><span class="line">	ros==ServiceClient clear_background = node.<span class="built_in">serviceClient</span>&lt;std_srvs==Empty&gt;(<span class="string">&quot;/clear&quot;</span>);</span><br><span class="line">	std_srvs::Empty srv;</span><br><span class="line">	clear_background.<span class="built_in">call</span>(srv);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-2-2-用python实现参数的使用">8.2.2 用python实现参数的使用</h4>
<p>其中<code>parameter_config.py</code>代码的结构为：</p>
<ul>
<li>初始化ROS节点；</li>
<li>get函数获取参数；</li>
<li>set函数设置参数。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该例程设置/读取海龟例程中的参数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_srvs.srv <span class="keyword">import</span> Empty</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parameter_config</span>():</span><br><span class="line">	<span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;parameter_config&#x27;</span>, anonymous=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 读取背景颜色参数</span></span><br><span class="line">    red   = rospy.get_param(<span class="string">&#x27;/background_r&#x27;</span>)</span><br><span class="line">    green = rospy.get_param(<span class="string">&#x27;/background_g&#x27;</span>)</span><br><span class="line">    blue  = rospy.get_param(<span class="string">&#x27;/background_b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;Get Backgroud Color[%d, %d, %d]&quot;</span>, red, green, blue)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 设置背景颜色参数</span></span><br><span class="line">    rospy.set_param(<span class="string">&quot;/background_r&quot;</span>, <span class="number">255</span>);</span><br><span class="line">    rospy.set_param(<span class="string">&quot;/background_g&quot;</span>, <span class="number">255</span>);</span><br><span class="line">    rospy.set_param(<span class="string">&quot;/background_b&quot;</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;Set Backgroud Color[255, 255, 255]&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 读取背景颜色参数</span></span><br><span class="line">    red   = rospy.get_param(<span class="string">&#x27;/background_r&#x27;</span>)</span><br><span class="line">    green = rospy.get_param(<span class="string">&#x27;/background_g&#x27;</span>)</span><br><span class="line">    blue  = rospy.get_param(<span class="string">&#x27;/background_b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;Get Backgroud Color[%d, %d, %d]&quot;</span>, red, green, blue)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 发现/spawn服务后，创建一个服务客户端，连接名为/spawn的service</span></span><br><span class="line">    rospy.wait_for_service(<span class="string">&#x27;/clear&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        clear_background = rospy.ServiceProxy(<span class="string">&#x27;/clear&#x27;</span>, Empty)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 请求服务调用，输入请求数据</span></span><br><span class="line">        response = clear_background()</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">except</span> rospy.ServiceException, e:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Service call failed: %s&quot;</span>%e</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    parameter_config()</span><br></pre></td></tr></table></figure>
<h3 id="8-3-配置代码编译规则">8.3 配置代码编译规则</h3>
<p>配置<code>CMakeLists.txt</code>中的编译规则：</p>
<ul>
<li>设置需要编译的代码和生成的可执行文件</li>
<li>设置链接库</li>
</ul>
<p>将以下代码加入<code>CMakeLists.txt</code>中：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_executable(parameter_config src/parameter_config.cpp)</span><br><span class="line">target_link_libraries(parameter_config $&#123;catkin_LIBRARIES&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/SeNEGzXbALjxd7w.png" alt="image-20220110232209217"></p>
<p>然后在工作空间<code>catkin_ws</code>中用<code>catkin_make</code>进行编译，具体步骤如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make</span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">roscore</span><br><span class="line">rosrun turtlesim turtlesim_node</span><br><span class="line">rosrun learning_parameter parameter_config</span><br></pre></td></tr></table></figure>
<p>现象：小海龟的背景颜色由蓝色变为白色。</p>
<p><img src="https://vip2.loli.io/2023/03/13/Rm3lbIEVxkuLwpN.png" alt="image-20220110232902080"></p>
<p><img src="https://vip2.loli.io/2023/03/13/CQIOMuvlH7dPjp9.png" alt="image-20220110232751454"></p>
<h2 id="9-ROS中的坐标系管理系统">9. ROS中的坐标系管理系统</h2>
<p>机器人中的坐标变换（参考《机器人学导论》）：</p>
<p><img src="https://vip2.loli.io/2023/03/13/nCWLOdtzXpbFHru.png" alt="image-20220110234826366"></p>
<p><img src="https://vip2.loli.io/2023/03/13/KtdDPoFUzAY3eEI.png" alt="image-20220110235326959"></p>
<p><strong>通过tf管理两个坐标系</strong>。</p>
<p>坐标变换的示例，打开终端输入以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ros-melodic-turtle-tf</span><br><span class="line">roslaunch turtle_tf turtle_tf_demo.launch</span><br><span class="line">rosrun turtlesim turtle_teleop_key</span><br><span class="line">rosrun tf view_frames</span><br></pre></td></tr></table></figure>
<p>第一句命令的意思是需要安装<code>turtle_tf</code>示例的功能包。</p>
<p><strong>工具一</strong>：看到系统中所有tf之间的关系</p>
<p><code>rosrun tf view_frames</code>可以可视化看到系统中所有tf之间的关系，也是调试机器人经常用到的工具，输入命令后需要监听5s，5s内所有坐标系之间的关系都保存下来。</p>
<p><img src="https://vip2.loli.io/2023/03/13/snMwevWptE5xIF7.png" alt="image-20220111000720492"></p>
<p>world坐标系就是全局坐标系，表示的是整个仿真器的坐标原点，即左下角的原点，这个坐标点是不会动的。</p>
<p><strong>工具二</strong>：通过<code>tf_echo</code>查看两个坐标系之间的关系：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun tf tf_echo turtle1 turtle2</span><br></pre></td></tr></table></figure>
<p>这个描述了turtle2坐标系通过怎样的变换变换到turtle1坐标系。</p>
<p>Translation：即在xyz三个方向上的平移。</p>
<p>Rotation：坐标系通过怎样的旋转可以变成一样的姿态。分别进行四元数、弧度、角度单位来进行描述。</p>
<p><img src="https://vip2.loli.io/2023/03/13/BHMvL6jnlIw2eGy.png" alt="image-20220111001708097"></p>
<p><strong>工具三</strong>：通过<code>rviz</code>查看两个坐标系之间的关系：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun rviz rviz -d `rospack find turtle_tf` /rviz/turtle_rviz.rviz</span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/hZA8mVTcbjuk5g6.png" alt="image-20220111002507221"></p>
<p>两个小海龟之间的坐标系的关系，可以通过两者和world坐标系的关系计算得到，两个四元矩阵具体计算如下：</p>
<p><img src="https://vip2.loli.io/2023/03/13/c4ZCjAowxbiXrRh.png" alt="image-20220111002759743"></p>
<h2 id="10-tf坐标系广播与监听的编程实现">10. tf坐标系广播与监听的编程实现</h2>
<p>创建功能包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws/src</span><br><span class="line">catkin_create_pkg learning_tf roscpp rospy tf turtlesim</span><br></pre></td></tr></table></figure>
<h3 id="10-1-创建tf广播器代码（C-python）">10.1 创建tf广播器代码（C++/python）</h3>
<p>如何实现一个tf广播器</p>
<ul>
<li>定义TF广播器（TransformBroadcaster）；</li>
<li>创建坐标变换值；</li>
<li>发布坐标变换（SendTransform）。</li>
</ul>
<p>在<code>catkin_ws/src/learning_tf/src</code>文件夹下创建<code>turtle_tf_broadcaste.cpp</code>文件，具体C++代码内容如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程产生tf数据，并计算、发布turtle2的速度指令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tf/transform_broadcaster.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;turtlesim/Pose.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::string turtle_name;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poseCallback</span><span class="params">(<span class="type">const</span> turtlesim::PoseConstPtr&amp; msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 创建tf的广播器</span></span><br><span class="line">	<span class="type">static</span> tf::TransformBroadcaster br;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化tf数据，填充坐标系之间的映射关系</span></span><br><span class="line">	tf::Transform transform;</span><br><span class="line">	transform.<span class="built_in">setOrigin</span>( tf::<span class="built_in">Vector3</span>(msg-&gt;x, msg-&gt;y, <span class="number">0.0</span>) );<span class="comment">//设置xyz方向上的平移参数，由于是平面所以z为0。</span></span><br><span class="line">	tf::Quaternion q;</span><br><span class="line">	q.<span class="built_in">setRPY</span>(<span class="number">0</span>, <span class="number">0</span>, msg-&gt;theta);<span class="comment">//设置xyz轴的旋转角度，由于是平面所以xy轴都为0，只存在z轴的旋转</span></span><br><span class="line">	transform.<span class="built_in">setRotation</span>(q);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 广播world与海龟坐标系之间的tf数据，广播之后可以在tf树中看到对应的关系</span></span><br><span class="line">	br.<span class="built_in">sendTransform</span>(tf==<span class="built_in">StampedTransform</span>(transform, ros==Time::<span class="built_in">now</span>(), <span class="string">&quot;world&quot;</span>, turtle_name));</span><br><span class="line">    <span class="comment">//tf是有时间的概念，所以会有时间戳，记录的是当前时间。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;my_tf_broadcaster&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 输入参数作为海龟的名字</span></span><br><span class="line">	<span class="keyword">if</span> (argc != <span class="number">2</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ROS_ERROR</span>(<span class="string">&quot;need turtle name as argument&quot;</span>); </span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	turtle_name = argv[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 订阅海龟的位姿话题</span></span><br><span class="line">	ros::NodeHandle node;</span><br><span class="line">	ros::Subscriber sub = node.<span class="built_in">subscribe</span>(turtle_name+<span class="string">&quot;/pose&quot;</span>, <span class="number">10</span>, &amp;poseCallback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数</span></span><br><span class="line">	ros::<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>具体python代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该例程将请求/show_person服务，服务数据类型learning_service::Person</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> roslib</span><br><span class="line">roslib.load_manifest(<span class="string">&#x27;learning_tf&#x27;</span>)</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tf</span><br><span class="line"><span class="keyword">import</span> turtlesim.msg</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_turtle_pose</span>(<span class="params">msg, turtlename</span>):</span><br><span class="line">    br = tf.TransformBroadcaster()</span><br><span class="line">    br.sendTransform((msg.x, msg.y, <span class="number">0</span>),</span><br><span class="line">                     tf.transformations.quaternion_from_euler(<span class="number">0</span>, <span class="number">0</span>, msg.theta),</span><br><span class="line">                     rospy.Time.now(),</span><br><span class="line">                     turtlename,</span><br><span class="line">                     <span class="string">&quot;world&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&#x27;turtle_tf_broadcaster&#x27;</span>)</span><br><span class="line">    turtlename = rospy.get_param(<span class="string">&#x27;~turtle&#x27;</span>)</span><br><span class="line">    rospy.Subscriber(<span class="string">&#x27;/%s/pose&#x27;</span> % turtlename,</span><br><span class="line">                     turtlesim.msg.Pose,</span><br><span class="line">                     handle_turtle_pose,</span><br><span class="line">                     turtlename)</span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure>
<h3 id="10-2-创建tf监听器代码（C-python）">10.2 创建tf监听器代码（C++/python）</h3>
<p>如何实现一个tf监听器</p>
<ul>
<li>定义TF广播器（TransformListener）；</li>
<li>查找坐标变换（waitForTransform、lookupTransform）。</li>
</ul>
<p>在<code>catkin_ws/src/learning_tf/src</code>文件夹下创建<code>turtle_tf_Listener.cpp</code>文件，具体内容如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程监听tf数据，并计算、发布turtle2的速度指令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tf/transform_listener.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;geometry_msgs/Twist.h&gt;</span>  <span class="comment">//给海龟发送速度指令</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;turtlesim/Spawn.h&gt;</span>  <span class="comment">//另外一只海龟通过Spawn来产生</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 初始化ROS节点</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;my_tf_listener&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">	ros::NodeHandle node;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 请求产生turtle2</span></span><br><span class="line">	ros==service==<span class="built_in">waitForService</span>(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line">	ros==ServiceClient add_turtle = node.<span class="built_in">serviceClient</span>&lt;turtlesim==Spawn&gt;(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line">	turtlesim::Spawn srv;</span><br><span class="line">	add_turtle.<span class="built_in">call</span>(srv);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建发布turtle2速度控制指令的发布者</span></span><br><span class="line">	ros==Publisher turtle_vel = node.<span class="built_in">advertise</span>&lt;geometry_msgs==Twist&gt;(<span class="string">&quot;/turtle2/cmd_vel&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建tf的监听器</span></span><br><span class="line">	tf::TransformListener listener;</span><br><span class="line"></span><br><span class="line">	<span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10.0</span>)</span></span>;<span class="comment">//设置while循环的频率</span></span><br><span class="line">	<span class="keyword">while</span> (node.<span class="built_in">ok</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 获取turtle1与turtle2坐标系之间的tf数据</span></span><br><span class="line">		tf::StampedTransform transform;</span><br><span class="line">		<span class="keyword">try</span></span><br><span class="line">		&#123;</span><br><span class="line">			listener.<span class="built_in">waitForTransform</span>(<span class="string">&quot;/turtle2&quot;</span>, <span class="string">&quot;/turtle1&quot;</span>, ros==<span class="built_in">Time</span>(<span class="number">0</span>), ros==<span class="built_in">Duration</span>(<span class="number">3.0</span>));<span class="comment">//是否存在turtle1和turtle2坐标系</span></span><br><span class="line">			listener.<span class="built_in">lookupTransform</span>(<span class="string">&quot;/turtle2&quot;</span>, <span class="string">&quot;/turtle1&quot;</span>, ros::<span class="built_in">Time</span>(<span class="number">0</span>), transform);<span class="comment">//如果存在则进行这一句，再查询两个坐标系的关系</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">catch</span> (tf::TransformException &amp;ex) </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">ROS_ERROR</span>(<span class="string">&quot;%s&quot;</span>,ex.<span class="built_in">what</span>());</span><br><span class="line">			ros::<span class="built_in">Duration</span>(<span class="number">1.0</span>).<span class="built_in">sleep</span>();</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 根据turtle1与turtle2坐标系之间的位置关系，发布turtle2的速度控制指令</span></span><br><span class="line">		geometry_msgs::Twist vel_msg;</span><br><span class="line">		vel_msg.angular.z = <span class="number">4.0</span> * <span class="built_in">atan2</span>(transform.<span class="built_in">getOrigin</span>().<span class="built_in">y</span>(),</span><br><span class="line">				                        transform.<span class="built_in">getOrigin</span>().<span class="built_in">x</span>());<span class="comment">//角速度计算</span></span><br><span class="line">		vel_msg.linear.x = <span class="number">0.5</span> * <span class="built_in">sqrt</span>(<span class="built_in">pow</span>(transform.<span class="built_in">getOrigin</span>().<span class="built_in">x</span>(), <span class="number">2</span>) +</span><br><span class="line">				                      <span class="built_in">pow</span>(transform.<span class="built_in">getOrigin</span>().<span class="built_in">y</span>(), <span class="number">2</span>));<span class="comment">//线速度计算</span></span><br><span class="line">		turtle_vel.<span class="built_in">publish</span>(vel_msg);<span class="comment">//发布速度</span></span><br><span class="line"></span><br><span class="line">		rate.<span class="built_in">sleep</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>具体python代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该例程将请求/show_person服务，服务数据类型learning_service::Person</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> roslib</span><br><span class="line">roslib.load_manifest(<span class="string">&#x27;learning_tf&#x27;</span>)</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> tf</span><br><span class="line"><span class="keyword">import</span> geometry_msgs.msg</span><br><span class="line"><span class="keyword">import</span> turtlesim.srv</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&#x27;turtle_tf_listener&#x27;</span>) <span class="comment"># 初始化节点</span></span><br><span class="line"></span><br><span class="line">    listener = tf.TransformListener() <span class="comment"># 创建tf_listener</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 通过Spawn产生新的海龟</span></span><br><span class="line">    rospy.wait_for_service(<span class="string">&#x27;spawn&#x27;</span>)</span><br><span class="line">    spawner = rospy.ServiceProxy(<span class="string">&#x27;spawn&#x27;</span>, turtlesim.srv.Spawn)</span><br><span class="line">    spawner(<span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="string">&#x27;turtle2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    turtle_vel = rospy.Publisher(<span class="string">&#x27;turtle2/cmd_vel&#x27;</span>, geometry_msgs.msg.Twist,queue_size=<span class="number">1</span>)<span class="comment">#创建publisher发布海龟2的速度指令</span></span><br><span class="line"></span><br><span class="line">    rate = rospy.Rate(<span class="number">10.0</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():  <span class="comment"># 查询坐标1和坐标2之间的坐标关系，查询的是当前时间，得到平移trans和旋转rot</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            (trans,rot) = listener.lookupTransform(<span class="string">&#x27;/turtle2&#x27;</span>, <span class="string">&#x27;/turtle1&#x27;</span>, rospy.Time(<span class="number">0</span>))</span><br><span class="line">        <span class="keyword">except</span> (tf.LookupException, tf.ConnectivityException, tf.ExtrapolationException):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        angular = <span class="number">4</span> * math.atan2(trans[<span class="number">1</span>], trans[<span class="number">0</span>])</span><br><span class="line">        linear = <span class="number">0.5</span> * math.sqrt(trans[<span class="number">0</span>] ** <span class="number">2</span> + trans[<span class="number">1</span>] ** <span class="number">2</span>)</span><br><span class="line">        cmd = geometry_msgs.msg.Twist()</span><br><span class="line">        cmd.linear.x = linear</span><br><span class="line">        cmd.angular.z = angular</span><br><span class="line">        turtle_vel.publish(cmd)</span><br><span class="line"></span><br><span class="line">        rate.sleep()</span><br></pre></td></tr></table></figure>
<h3 id="10-3-配置编译规则">10.3 配置编译规则</h3>
<p>打开<code>catkin_ws/src/learning_tf/src</code>文件夹，配置<code>CMakeLists.txt</code>中的编译规则：</p>
<ul>
<li>设置需要编译的代码和生成 的可执行文件</li>
<li>设置链接库</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">add_executable(turtle_tf_broadcaster src/turtle_tf_broadcaster.cpp)</span><br><span class="line">target_link_libraries(turtle_tf_broadcaster $&#123;catkin_LIBRARIES&#125;)</span><br><span class="line"></span><br><span class="line">add_executable(turtle_tf_listener src/turtle_tf_listener.cpp)</span><br><span class="line">target_link_libraries(turtle_tf_listener $&#123;catkin_LIBRARIES&#125;)</span><br></pre></td></tr></table></figure>
<p>然后回到工作空间的根目录catkin_ws通过<code>catkin_make</code>进行编译。</p>
<p>通过以下命令运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make</span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">roscore</span><br><span class="line">rosrun turtlesim turtlesim_node</span><br><span class="line">rosrun learning_tf turtle_tf_broadcaster_name:=turtle1_tf_broadcaster /turtle1</span><br><span class="line">rosrun learning_tf turtle_tf_broadcaster_name:=turtle2_tf_broadcaster /turtle2</span><br><span class="line">rosrun learning_tf turtle_tf_listener</span><br><span class="line">rosrun turtlesim turtle_teleop_key</span><br></pre></td></tr></table></figure>
<p>上面第6、7行代码中<code>turtle1_tf_broadcaster</code>会取代程序中的<code>my_tf_broadcaster</code>，因此虽然是同一个程序，但是两个节点的名字不一样，可以运行两次。</p>
<h2 id="11-launch启动文件的使用方法">11. launch启动文件的使用方法</h2>
<p>launch文件：通过XML文件实现多节点的配置和启动（可自动启动ROS Master）</p>
<p>launch文件中有很多标签，标签中有很多属性，用launch文件可以不用打开很多终端启动很多节点。</p>
<p>原来是通过<code>roscore</code>启动ROS Master，launch文件可以自动启动ROS Master。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sim1&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtlesim_node&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sim2&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtlesim_node&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>基本属性</strong>：</p>
<p>pkg：节点所在的功能包名称</p>
<p>type：节点的可执行文件名称</p>
<p>name：节点运行时的名称</p>
<p><strong>可选属性</strong>：</p>
<p>output：是否将某个节点的日志信息打印到终端</p>
<p>respawn：节点启动失败是否进行重启</p>
<p>required：某个节点是否一定要启动起来</p>
<p>ns：namespace，给每个节点一个命名空间，避免命名冲突</p>
<p>args：给每个节点输入一些参数来使用</p>
<p><img src="https://vip2.loli.io/2023/03/13/4ekhgPMmuGcpzB3.png" alt="image-20220111185654776"></p>
<p><strong>其他常用属性</strong>：</p>
<p><code>&lt;param&gt;/&lt;rosparam&gt;</code>：设置ROS系统运行中的参数，存储在参数服务器中。</p>
<p><code>&lt;param name=&quot;output_frame&quot; value=&quot;odom&quot;/&gt;</code></p>
<ul>
<li>name：参数名</li>
<li>value：参数值</li>
</ul>
<p>加载参数文件中的多个参数：<code>&lt;rosparam file=&quot;params.yaml&quot; command=&quot;load&quot; ns= &quot;params&quot;/&gt;</code></p>
<p><code>&lt;arg&gt;</code>：launch文件内部的局部变量，仅限于launch文件使用，也可以给node作为输入参数</p>
<p><code>&lt;arg name=&quot;arg-name&quot; default=&quot;arg-value&quot;/&gt;</code></p>
<ul>
<li>name：参数名</li>
<li>value：参数值</li>
</ul>
<p>调用：</p>
<p><code>&lt;param name=&quot;foo&quot; value=&quot;$(arg arg-name)&quot;/&gt;</code></p>
<p><code>&lt;node name=&quot;node&quot; pkg=&quot;package&quot; type=&quot;type&quot; args=&quot;$arg arg-name&quot;/&gt;</code></p>
<p><strong>两种参数设置对比</strong>：</p>
<p><img src="https://vip2.loli.io/2023/03/13/YQHJjTBdm9i2brI.png" alt="image-20220111193459643"></p>
<p><img src="https://vip2.loli.io/2023/03/13/b2KzDvjxHQucBZ7.png" alt="image-20220111193427479"></p>
<p><img src="https://vip2.loli.io/2023/03/13/bKEO6wVpCq8zLHR.png" alt="image-20220111193835852"></p>
<h3 id="11-1-launch文件编程实现-示例一">11.1 launch文件编程实现-示例一</h3>
<p>launch文件编程实现：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws/src</span><br><span class="line">catkin_create_pkg learning_launch</span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/3hCVeRZAuvInr6F.png" alt="image-20220111203810852"></p>
<p>一般在创建launch功能包之后，里面没有launch文件，通过新建launch文件夹方便管理功能包里面的各种资源。</p>
<p><img src="https://vip2.loli.io/2023/03/13/FcCMT8gxleuEDNG.png" alt="image-20220111204053287"></p>
<p>在launch文件夹中新建simple.launch文件，里面的内容为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;learning_topic&quot;</span> <span class="attr">type</span>=<span class="string">&quot;person_subscriber&quot;</span> <span class="attr">name</span>=<span class="string">&quot;talker&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;learning_topic&quot;</span> <span class="attr">type</span>=<span class="string">&quot;person_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;listener&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>两个<code>node</code>标签分别启动两个<code>node</code>节点，一个是<code>learning_topic</code>功能包下面的<code>talker</code>节点，一个是<code>learning_topic</code>功能包下面的<code>listener</code>节点，<code>talker</code>的节点名为<code>person_subscriber</code>，<code>listener</code>的节点名为<code>person_publisher</code>，默认两个节点名不会打印到终端，为了保证显示效果，将其<code>output</code>设置为<code>screen</code>。</p>
<p>在工作空间的根目录<code>~/catkin_ws</code>中通过<code>catkin_make</code>编译一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosluanch learning_launch simple.launch</span><br></pre></td></tr></table></figure>
<p><img src="https://vip2.loli.io/2023/03/13/uyxRWic4l2KqNBn.png" alt="image-20220111205437126"></p>
<p><img src="https://vip2.loli.io/2023/03/13/zqKBxDM5bOrWFZs.png" alt="image-20220111205515374"></p>
<p>可以通过图片看出，所有的节点在一个终端启动，publisher发布一个信息，subscriber订阅一个信息。</p>
<h3 id="11-2-launch文件编程实现-示例二">11.2 launch文件编程实现-示例二</h3>
<p>在launch文件夹中，新建<code>turtlesim_parameter_config.launch</code>文件，具体内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;/turtle_number&quot;</span>   <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtlesim_node&quot;</span> <span class="attr">name</span>=<span class="string">&quot;turtlesim_node&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;turtle_name1&quot;</span>   <span class="attr">value</span>=<span class="string">&quot;Tom&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;turtle_name2&quot;</span>   <span class="attr">value</span>=<span class="string">&quot;Jerry&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find learning_launch)/config/param.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtle_teleop_key&quot;</span> <span class="attr">name</span>=<span class="string">&quot;turtle_teleop_key&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>param和rosparam都是设置变量的，第一个参数名为turtle_number，数值为2。rosparam通过查找地址，加载一个参数文件param.yaml。</p>
<p><code>$(find learning_launch)</code>指的是搜索<code>learning_launch</code>文件夹的完整路径。</p>
<p>在<code>learning_launch</code>文件夹下新建<code>config</code>文件夹，在<code>config</code>文件夹下新建<code>param.yaml</code>文件，<code>param.yaml</code>具体内容如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">A:</span> <span class="number">123</span></span><br><span class="line"><span class="attr">B:</span> <span class="string">&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">group:</span></span><br><span class="line">  <span class="attr">C:</span> <span class="number">456</span></span><br><span class="line">  <span class="attr">D:</span> <span class="string">&quot;hello&quot;</span></span><br></pre></td></tr></table></figure>
<p>通过<code>roslaunch learning_launch turtlesim_parameter_config.launch</code>命令来启动<code>launch</code>文件。</p>
<p>通过<code>rosparam list</code>列出参数：</p>
<p><img src="https://vip2.loli.io/2023/03/13/yqExMonp2BQWGIL.png" alt="image-20220111215032993"></p>
<p><img src="https://vip2.loli.io/2023/03/13/aBsSEj1Hb4dpoUN.png" alt="image-20220111215238752"></p>
<h3 id="11-3-launch文件编程实现-示例三">11.3 launch文件编程实现-示例三</h3>
<p>在<code>~/catkin_ws/src/learning_launch/launch</code>文件夹中，新建<code>start_tf_demo_c++.launch</code>文件，具体内容如下：</p>
<p>相应的launch文件内容为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Turtlesim Node--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtlesim_node&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sim&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtle_teleop_key&quot;</span> <span class="attr">name</span>=<span class="string">&quot;teleop&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;learning_tf&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtle_tf_broadcaster&quot;</span> <span class="attr">args</span>=<span class="string">&quot;/turtle1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;turtle1_tf_broadcaster&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;learning_tf&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtle_tf_broadcaster&quot;</span> <span class="attr">args</span>=<span class="string">&quot;/turtle2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;turtle2_tf_broadcaster&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;learning_tf&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtle_tf_listener&quot;</span> <span class="attr">name</span>=<span class="string">&quot;listener&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在终端中运行命令<code>roslaunch learning_launch start_tf_demo_c++.launch</code>，得到如下效果：</p>
<p><img src="https://vip2.loli.io/2023/03/13/MQYnV3XF9gJ4dmO.png" alt="image-20220111220735050"></p>
<p>可以通过键盘控制小海龟1的移动，小海龟2会跟着移动。</p>
<p>针对python编写的launch文件如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- Turtlesim Node--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtlesim_node&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sim&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtle_teleop_key&quot;</span> <span class="attr">name</span>=<span class="string">&quot;teleop&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;turtle1_tf_broadcaster&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;learning_tf&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtle_tf_broadcaster.py&quot;</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;turtle&quot;</span> <span class="attr">type</span>=<span class="string">&quot;string&quot;</span> <span class="attr">value</span>=<span class="string">&quot;turtle1&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;turtle2_tf_broadcaster&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;learning_tf&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtle_tf_broadcaster.py&quot;</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;turtle&quot;</span> <span class="attr">type</span>=<span class="string">&quot;string&quot;</span> <span class="attr">value</span>=<span class="string">&quot;turtle2&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;learning_tf&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtle_tf_listener.py&quot;</span> <span class="attr">name</span>=<span class="string">&quot;listener&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="11-4-launch文件编程实现-示例四">11.4 launch文件编程实现-示例四</h3>
<p>在<code>~/catkin_ws/src/learning_launch/launch</code>文件夹中，新建<code>turtlesim_remap.launch</code>文件，具体内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find learning_launch)/launch/simple.launch&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtlesim_node&quot;</span> <span class="attr">name</span>=<span class="string">&quot;turtlesim_node&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;/turtle1/cmd_vel&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/cmd_vel&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>一个launch文件包含另外一个launch文件（simple.launch）。</p>
<p>第6行代码是将<code>/turtle1/cmd_vel</code>改为<code>/cmd_vel</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch learning_launch turtlesim_remap.launch</span><br></pre></td></tr></table></figure>
<p>效果如下：<code>/turtle1/cmd_vel</code>变为<code>/cmd_vel</code>。发布一个话题，可以看到小乌龟发生移动。</p>
<p><img src="https://vip2.loli.io/2023/03/13/mG6KAbpesJPNHWU.png" alt="image-20220111222426143"></p>
<h2 id="12-常用可视化工具的使用">12. 常用可视化工具的使用</h2>
<h3 id="12-1-Qt工具箱">12.1 Qt工具箱</h3>
<p><strong>Qt工具箱常用工具</strong>：</p>
<p>日志输出工具——rqt_console</p>
<p>计算图可视化工具——rqt_graph</p>
<p>数据绘图软件——rqt_plot</p>
<p>图像渲染工具——rqt_image_view</p>
<p><strong>例程实现</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">roscore</span><br><span class="line">rosrun turtlesim turtlesim_node</span><br></pre></td></tr></table></figure>
<p>在终端中输入<code>rqt_</code>+Tab键，可以看到相关的工具，输入<code>rqt_console</code>命令：</p>
<p><img src="https://vip2.loli.io/2023/03/13/xBN4Kt7TdWVioG8.png" alt="image-20220111224658477"></p>
<p>例如通过控制小海龟移动撞墙后会有warning警告：</p>
<p><img src="https://vip2.loli.io/2023/03/13/gZFCmzHx86oUQhM.png" alt="image-20220111224647109"></p>
<p><img src="https://vip2.loli.io/2023/03/13/HYzhwgroA2pPF6K.png" alt="image-20220111225010422"></p>
<p>通过<code>rqt_plot</code>命令打开rqt_plot：</p>
<p><img src="https://vip2.loli.io/2023/03/13/x8CZjGSMfDJmHav.png" alt="image-20220111225556948"></p>
<p>命令<code>rqt_image_view</code>用来显示摄像头图像，界面如下图：</p>
<p><img src="https://vip2.loli.io/2023/03/13/DzECnjsvHS2OfhI.png" alt="image-20220111225753802"></p>
<p><img src="https://vip2.loli.io/2023/03/13/EFAVrRLmHzu7D13.png" alt="image-20220111225910615"></p>
<p>也可以通过在终端中输入<code>rqt</code>来进行，可以通过选择各种插件<code>Plugins</code>来进行相关操作。</p>
<h3 id="12-2-Rviz">12.2 Rviz</h3>
<p>Rviz是一款三维可视化工具，可以很好的兼容基于ROS软件框架的机器人平台。</p>
<ul>
<li>在rviz中，可以使用<strong>可扩展标记语言XML</strong>对机器人、周围物体等任何事物进行尺寸、质量、位置、材质、关节等属性的描述，并且在界面中呈现出来。</li>
<li>同时，rviz还可以通过<strong>图形化的方式</strong>，实时显示机器人传感器的信息、机器人的运动状态、周围环境的变化等信息。</li>
<li>总而言之，rviz通过机器人模型参数、机器人发布的传感信息等数据，为用户进行所有<strong>可监测信息的图形化显示</strong>。用户和开发者也可以在rviz的控制界面下，通过按钮、滑动条、数值等方式，控制机器人的行为。</li>
</ul>
<p><img src="https://vip2.loli.io/2023/03/13/8UvVPuDwG47XifO.png" alt="image-20220111231005413"></p>
<h3 id="12-3-Gazebo">12.3 Gazebo</h3>
<p>Gazebo是一款功能强大的三维物理仿真平台</p>
<ul>
<li>具备强大的物理引擎</li>
<li>高质量的渲染</li>
<li>方便的编程与图形接口</li>
<li>开源免费</li>
</ul>
<p>其典型应用场景包括：</p>
<ul>
<li>测试机器人算法</li>
<li>机器人的设计</li>
<li>现实场景下的回溯测试</li>
</ul>
<p><img src="https://vip2.loli.io/2023/03/13/KDATeSvkIyjlwZg.png" alt="image-20220111231618821"></p>
<p><img src="https://vip2.loli.io/2023/03/13/NJL5n4WHuy783st.png" alt="image-20220111231715803"></p>
<p>Gazebo的启动：</p>
<p>通过命令<code>roslaunch gazebo_ros</code>可以看到相关launch文件。</p>
<h2 id="13-课程总结与进阶攻略">13. 课程总结与进阶攻略</h2>
<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="http://wiki.ros">http://wiki.ros</a>,org/ros_control</p>
<p><a target="_blank" rel="noopener" href="http://wiki.ros">http://wiki.ros</a>,org/gmapping/</p>
<p><a target="_blank" rel="noopener" href="http://wiki.ros">http://wiki.ros</a>,org/hector_slam</p>
<p><img src="https://vip2.loli.io/2023/03/13/8sJlq2e34kxWGO9.png" alt="image-20220111233417230"></p>
<p><img src="https://vip2.loli.io/2023/03/13/T12ZeO5tUy3hq8o.png" alt="image-20220111233509788"></p>
<p>斯坦福大学公开课——机器人学：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av4506104">https://www.bilibili.com/video/av4506104</a></p>
<p>台湾交通大学——机器人学：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av18516816">https://www.bilibili.com/video/av18516816</a></p>
<p>Andrew Davison的机器人学讲座课程：<a target="_blank" rel="noopener" href="http://www.doc.ic.ac.uk/~ajd/Robotics/index.html">http://www.doc.ic.ac.uk/~ajd/Robotics/index.html</a></p>
<p>ETH - Robotic Systems Lab：<a target="_blank" rel="noopener" href="http://www.rsl.ethz.ch/education-students/lectures.html">http://www.rsl.ethz.ch/education-students/lectures.html</a></p>
<p>古月学院：PC：<a target="_blank" rel="noopener" href="https://class.guyuehome.com">https://class.guyuehome.com</a>     手机：“古月居”微信公众号→古月学院</p>
<p>ROS：<a target="_blank" rel="noopener" href="https://www.ros.org/">https://www.ros.org/</a></p>
<p>ROS Wiki：<a target="_blank" rel="noopener" href="http://wiki.ros.org/">http://wiki.ros.org/</a></p>
<p>ROS Con 2012 ~2019：<a target="_blank" rel="noopener" href="https://roscon.ros.org/world/2021/">https://roscon.ros.org/world/2021/</a></p>
<p>ROS Robots：<a target="_blank" rel="noopener" href="https://robots.ros.org/">https://robots.ros.org/</a></p>
<p>Ubuntu Wiki：<a target="_blank" rel="noopener" href="https://wiki.ubuntu.org.cn/">https://wiki.ubuntu.org.cn/</a></p>
<p>古月居：<a target="_blank" rel="noopener" href="https://www.guyuehome.com">https://www.guyuehome.com</a></p>
<p>古月居泡泡：<a target="_blank" rel="noopener" href="https://www.guyuehome.com/Bubble">https://www.guyuehome.com/Bubble</a></p>
<p>古月学院：<a target="_blank" rel="noopener" href="https://class.guyuehome.com">https://class.guyuehome.com</a></p>
<p><img src="https://vip2.loli.io/2023/03/13/TgcpWN983U4Rwtz.png" alt="image-20220111235717355"></p>
<p><img src="https://vip2.loli.io/2023/03/13/FEi4MwWs8hjBpfZ.png" alt="image-20220111235740995"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://ywwsnowboy.github.io">snowboy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://ywwsnowboy.github.io/2022/05/06/ROS/ROS%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0/">https://ywwsnowboy.github.io/2022/05/06/ROS/ROS%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://ywwsnowboy.github.io" target="_blank">既然选择了远方 便只顾风雨兼程</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ROS/">ROS</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2023/03/12/LHTi19ID7PoAWfG.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/05/06/ROS/ROS%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"><img class="prev-cover" src="https://s2.loli.net/2023/03/12/gtzD3EsvB78fNCn.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ROS基础概念</div></div></a></div><div class="next-post pull-right"><a href="/2022/05/06/ROS/%E6%9C%8D%E5%8A%A1%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8BTrigger/"><img class="next-cover" src="https://s2.loli.net/2023/03/12/mW78kcGPUNtDblR.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ROS服务数据类型Trigger</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/05/06/ROS/ROS%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" title="ROS基础概念"><img class="cover" src="https://s2.loli.net/2023/03/12/gtzD3EsvB78fNCn.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-06</div><div class="title">ROS基础概念</div></div></a></div><div><a href="/2022/05/06/ROS/%E6%9C%8D%E5%8A%A1%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8BTrigger/" title="ROS服务数据类型Trigger"><img class="cover" src="https://s2.loli.net/2023/03/12/mW78kcGPUNtDblR.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-06</div><div class="title">ROS服务数据类型Trigger</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NTU2NC8zMjAzMQ=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">snowboy</div><div class="author-info__description">满招损 谦受益</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">40</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ywwsnowboy/"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ywwsnowboy" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:ywwsnowboy@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.cnblogs.com/ywwsnowboy/" target="_blank" title="Blog"><i class="fa-solid fa-cube"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到snowboy的博客, 让我们一起进步吧！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">ROS编程实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%88%9B%E9%80%A0%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4%E5%92%8C%E5%8A%9F%E8%83%BD%E5%8C%85"><span class="toc-text">1. 创造工作空间和功能包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%88%9B%E5%BB%BA%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4"><span class="toc-text">1.1 创建工作空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%88%9B%E5%BB%BA%E5%8A%9F%E8%83%BD%E5%8C%85"><span class="toc-text">1.2 创建功能包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%8F%91%E5%B8%83%E8%80%85Publisher%E7%9A%84%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="toc-text">2. 发布者Publisher的编程实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%88%9B%E5%BB%BA%E5%8A%9F%E8%83%BD%E5%8C%85"><span class="toc-text">2.1 创建功能包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E9%85%8D%E7%BD%AE%E5%8F%91%E5%B8%83%E8%80%85%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91%E8%A7%84%E5%88%99"><span class="toc-text">2.2 配置发布者代码编译规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E7%94%A8C-python%E5%AE%9E%E7%8E%B0%E5%8F%91%E5%B8%83%E8%80%85"><span class="toc-text">2.3 用C++&#x2F;python实现发布者</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E7%BC%96%E8%AF%91%E5%B9%B6%E8%BF%90%E8%A1%8C%E5%8F%91%E5%B8%83%E8%80%85"><span class="toc-text">2.4 编译并运行发布者</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%AE%A2%E9%98%85%E8%80%85Subscriber%E7%9A%84%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="toc-text">3. 订阅者Subscriber的编程实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E9%85%8D%E7%BD%AE%E5%8F%91%E5%B8%83%E8%80%85%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91%E8%A7%84%E5%88%99"><span class="toc-text">3.1 配置发布者代码编译规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E7%94%A8C-python%E5%AE%9E%E7%8E%B0%E8%AE%A2%E9%98%85%E8%80%85"><span class="toc-text">3.2 用C++&#x2F;python实现订阅者</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E7%BC%96%E8%AF%91%E5%B9%B6%E8%BF%90%E8%A1%8C%E5%8F%91%E5%B8%83%E8%80%85"><span class="toc-text">3.3 编译并运行发布者</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%AF%9D%E9%A2%98%E6%B6%88%E6%81%AF%E7%9A%84%E5%AE%9A%E4%B9%89%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-text">4. 话题消息的定义与使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B6%88%E6%81%AF%E6%96%87%E4%BB%B6%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-text">4.1 自定义消息文件的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%AF%9D%E9%A2%98%E6%B6%88%E6%81%AF%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">4.2 话题消息的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-C-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%8F%91%E5%B8%83%E8%80%85"><span class="toc-text">4.2.1 C++代码实现发布者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-C-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E8%AE%A2%E9%98%85%E8%80%85"><span class="toc-text">4.2.2 C++代码实现订阅者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-%E7%BC%96%E8%AF%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">4.2.3  编译配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-4-python%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">4.2.4 python代码实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%AE%A2%E6%88%B7%E7%AB%AFClient%E7%9A%84%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="toc-text">5. 客户端Client的编程实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%E5%88%9B%E5%BB%BA%E5%8A%9F%E8%83%BD%E5%8C%85"><span class="toc-text">5.1创建功能包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-C-python%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">5.2 C++&#x2F;python代码实现客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1-C-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">5.2.1 C++代码实现客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-python%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">5.2.2 python代码实现客户端</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E9%85%8D%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91%E8%A7%84%E5%88%99"><span class="toc-text">5.3 配置客户端代码编译规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E7%BC%96%E8%AF%91%E5%B9%B6%E8%BF%90%E8%A1%8C%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">5.4 编译并运行客户端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%9C%8D%E5%8A%A1%E7%AB%AFServer%E7%9A%84%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="toc-text">6. 服务端Server的编程实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E7%94%A8C-python%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">6.1 用C++&#x2F;python实现一个服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-1-%E7%94%A8C-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">6.1.1 用C++实现一个服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-2-%E7%94%A8python%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">6.1.2 用python实现一个服务器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91%E8%A7%84%E5%88%99"><span class="toc-text">6.2 配置服务器代码编译规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E7%BC%96%E8%AF%91%E5%B9%B6%E8%BF%90%E8%A1%8C%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">6.3 编译并运行服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-1-%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8CC-%E7%A8%8B%E5%BA%8F"><span class="toc-text">6.3.1 编译运行C++程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-2-%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8Cpython%E7%A8%8B%E5%BA%8F"><span class="toc-text">6.3.2 编译运行python程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%9C%8D%E5%8A%A1%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="toc-text">7. 服务数据的定义和使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E5%A6%82%E4%BD%95%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1%E6%95%B0%E6%8D%AE"><span class="toc-text">7.1 如何自定义服务数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">7.2 相关代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-C-%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">7.2.1 C++相关代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-python%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">7.2.2 python相关代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91%E8%A7%84%E5%88%99"><span class="toc-text">7.3 配置服务器&#x2F;客户端代码编译规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E7%BC%96%E8%AF%91%E5%B9%B6%E8%BF%90%E8%A1%8C%E5%8F%91%E5%B8%83%E8%80%85%E5%92%8C%E8%AE%A2%E9%98%85%E8%80%85"><span class="toc-text">7.4 编译并运行发布者和订阅者</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%8F%82%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E7%BC%96%E7%A8%8B%E6%96%B9%E6%B3%95"><span class="toc-text">8. 参数的使用与编程方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E5%8F%82%E6%95%B0%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">8.1 参数模型的使用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E7%94%A8C-python%E5%AE%9E%E7%8E%B0%E5%8F%82%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">8.2 用C++&#x2F;python实现参数的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-1-%E7%94%A8C-%E5%AE%9E%E7%8E%B0%E5%8F%82%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">8.2.1 用C++实现参数的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-%E7%94%A8python%E5%AE%9E%E7%8E%B0%E5%8F%82%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">8.2.2 用python实现参数的使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91%E8%A7%84%E5%88%99"><span class="toc-text">8.3 配置代码编译规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-ROS%E4%B8%AD%E7%9A%84%E5%9D%90%E6%A0%87%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-text">9. ROS中的坐标系管理系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-tf%E5%9D%90%E6%A0%87%E7%B3%BB%E5%B9%BF%E6%92%AD%E4%B8%8E%E7%9B%91%E5%90%AC%E7%9A%84%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="toc-text">10. tf坐标系广播与监听的编程实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E5%88%9B%E5%BB%BAtf%E5%B9%BF%E6%92%AD%E5%99%A8%E4%BB%A3%E7%A0%81%EF%BC%88C-python%EF%BC%89"><span class="toc-text">10.1 创建tf广播器代码（C++&#x2F;python）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-%E5%88%9B%E5%BB%BAtf%E7%9B%91%E5%90%AC%E5%99%A8%E4%BB%A3%E7%A0%81%EF%BC%88C-python%EF%BC%89"><span class="toc-text">10.2 创建tf监听器代码（C++&#x2F;python）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-%E9%85%8D%E7%BD%AE%E7%BC%96%E8%AF%91%E8%A7%84%E5%88%99"><span class="toc-text">10.3 配置编译规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-launch%E5%90%AF%E5%8A%A8%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">11. launch启动文件的使用方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-launch%E6%96%87%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0-%E7%A4%BA%E4%BE%8B%E4%B8%80"><span class="toc-text">11.1 launch文件编程实现-示例一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-launch%E6%96%87%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0-%E7%A4%BA%E4%BE%8B%E4%BA%8C"><span class="toc-text">11.2 launch文件编程实现-示例二</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-launch%E6%96%87%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0-%E7%A4%BA%E4%BE%8B%E4%B8%89"><span class="toc-text">11.3 launch文件编程实现-示例三</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-launch%E6%96%87%E4%BB%B6%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0-%E7%A4%BA%E4%BE%8B%E5%9B%9B"><span class="toc-text">11.4 launch文件编程实现-示例四</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E5%B8%B8%E7%94%A8%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">12. 常用可视化工具的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-Qt%E5%B7%A5%E5%85%B7%E7%AE%B1"><span class="toc-text">12.1 Qt工具箱</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-Rviz"><span class="toc-text">12.2 Rviz</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-3-Gazebo"><span class="toc-text">12.3 Gazebo</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E8%AF%BE%E7%A8%8B%E6%80%BB%E7%BB%93%E4%B8%8E%E8%BF%9B%E9%98%B6%E6%94%BB%E7%95%A5"><span class="toc-text">13. 课程总结与进阶攻略</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/03/14/Git/Git%20%E6%95%99%E7%A8%8B/" title="Git 教程"><img src="https://vip2.loli.io/2023/03/14/DmcyM2PXwjx6gGk.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git 教程"/></a><div class="content"><a class="title" href="/2023/03/14/Git/Git%20%E6%95%99%E7%A8%8B/" title="Git 教程">Git 教程</a><time datetime="2023-03-14T12:16:02.000Z" title="发表于 2023-03-14 20:16:02">2023-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/11/Others/%E5%9C%A8cmd%E4%B8%AD%E4%BD%BF%E7%94%A8cygwin%E5%91%BD%E4%BB%A4/" title="在cmd中使用cygwin命令的环境配置"><img src="https://s2.loli.net/2023/03/12/YdLleNc2T4p7VGh.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在cmd中使用cygwin命令的环境配置"/></a><div class="content"><a class="title" href="/2022/12/11/Others/%E5%9C%A8cmd%E4%B8%AD%E4%BD%BF%E7%94%A8cygwin%E5%91%BD%E4%BB%A4/" title="在cmd中使用cygwin命令的环境配置">在cmd中使用cygwin命令的环境配置</a><time datetime="2022-12-11T03:13:23.000Z" title="发表于 2022-12-11 11:13:23">2022-12-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/23/Others/Jupyter%20notebook%E6%9B%B4%E6%94%B9%E6%96%87%E4%BB%B6%E9%BB%98%E8%AE%A4%E5%9C%B0%E5%9D%80/" title="Jupyter notebook更改文件默认地址"><img src="https://s2.loli.net/2023/03/12/mwdcI1GMbQJXBjk.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Jupyter notebook更改文件默认地址"/></a><div class="content"><a class="title" href="/2022/11/23/Others/Jupyter%20notebook%E6%9B%B4%E6%94%B9%E6%96%87%E4%BB%B6%E9%BB%98%E8%AE%A4%E5%9C%B0%E5%9D%80/" title="Jupyter notebook更改文件默认地址">Jupyter notebook更改文件默认地址</a><time datetime="2022-11-23T12:27:23.000Z" title="发表于 2022-11-23 20:27:23">2022-11-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/23/Others/VMware%E5%AE%89%E8%A3%85%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%95%99%E7%A8%8B/" title="VMware安装虚拟机教程"><img src="https://s2.loli.net/2023/03/12/RtgY2UVQFjTuNhM.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="VMware安装虚拟机教程"/></a><div class="content"><a class="title" href="/2022/11/23/Others/VMware%E5%AE%89%E8%A3%85%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%95%99%E7%A8%8B/" title="VMware安装虚拟机教程">VMware安装虚拟机教程</a><time datetime="2022-11-23T12:27:23.000Z" title="发表于 2022-11-23 20:27:23">2022-11-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/19/Others/Markdown%E6%95%99%E7%A8%8B/Markdown%E6%95%99%E7%A8%8B/" title="Markdown的简介"><img src="https://s2.loli.net/2023/03/12/Wosb3C5rPyJI2jv.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Markdown的简介"/></a><div class="content"><a class="title" href="/2022/11/19/Others/Markdown%E6%95%99%E7%A8%8B/Markdown%E6%95%99%E7%A8%8B/" title="Markdown的简介">Markdown的简介</a><time datetime="2022-11-19T11:18:28.000Z" title="发表于 2022-11-19 19:18:28">2022-11-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By snowboy</div><div class="footer_custom_text">很高兴认识你, 让我们一起努力吧!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>